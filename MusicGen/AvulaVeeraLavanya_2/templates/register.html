{% extends "base.html" %}
{% block title %}MusicGen Studio Â· Register{% endblock %}
{% block body_attrs %}data-route="register"{% endblock %}
{% block content %}
<h2 style="margin-top:0;">Create an Account</h2>
<p style="color:#9ca3af;">Sign up to start generating custom music clips tailored to your prompts.</p>

<form id="register-form" style="display:grid;gap:1rem;margin-top:1.5rem;">
	<label>
		Username
		<input id="username" required />
	</label>
	<label>
		Email
		<input id="email" type="email" required />
	</label>
	<label>
		Password
		<input id="password" type="password" minlength="8" required />
	</label>
	<button type="submit">Register</button>
</form>

<div class="status" id="status">Awaiting action...</div>

<p style="margin-top:1.5rem;">Already have an account? <a href="/login/" style="color:#38bdf8;">Log in</a>.</p>
{% endblock %}

{% block extra_scripts %}
<script>
	const statusBox = document.getElementById('status');
	function setStatus(message, isError = false) {
		statusBox.textContent = message;
		statusBox.style.color = isError ? '#f87171' : 'inherit';
	}

	document.getElementById('register-form').addEventListener('submit', async (event) => {
		event.preventDefault();
		setStatus('Registering...');
		const payload = {
			username: document.getElementById('username').value.trim(),
			email: document.getElementById('email').value.trim(),
			password: document.getElementById('password').value,
		};
		try {
			const response = await fetch('/api/register/', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify(payload),
			});
			if (!response.ok) {
				const text = await response.text();
				throw new Error(text || response.statusText);
			}
			const data = await response.json();
			setStatus(`Account created for ${data.username}. Redirecting to login...`);
			setTimeout(() => {
				window.location.href = '/login/';
			}, 1200);
		} catch (error) {
			setStatus(`Registration failed: ${error.message}`, true);
		}
	});
</script>
{% endblock %}

