<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - NexGenMusic</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/mood-wave-rider.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* 3D Background Canvas */
        #canvas3d {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        
        /* Make content appear above 3D background */
        .header, .main-layout {
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-hover: #f1f3f5;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --accent-blue: #3b82f6;
            --accent-purple: #a855f7;
            --accent-green: #10b981;
            --accent-pink: #ec4899;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 50%, #e1d1fa 100%);
            color: #1e293b;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header - Ghost White */
        .header {
            background: rgba(248, 248, 255, 0.98);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .logo:hover {
            color: #3b82f6;
            transform: scale(1.05);
        }

        .logo-icon {
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(219, 234, 254, 0.4));
        }

        .search-bar {
            flex: 1;
            max-width: 600px;
            margin: 0 40px;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 24px;
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
        }

        .search-input:focus {
            border-color: var(--accent-blue);
            background: var(--bg-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }

        .icon-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            position: relative;
        }

        /* User Profile Dropdown */
        .user-profile-wrapper {
            position: relative;
        }

        .user-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            width: 280px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: none;
            z-index: 1000;
            overflow: hidden;
        }

        .user-dropdown.show {
            display: block;
            animation: dropdownFadeIn 0.2s ease;
        }

        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-dropdown-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }

        .user-dropdown-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-dropdown-email {
            font-size: 13px;
            opacity: 0.9;
        }

        .user-dropdown-menu {
            padding: 8px;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .user-dropdown-item:hover {
            background: var(--bg-hover);
        }

        .user-dropdown-item svg {
            width: 18px;
            height: 18px;
            color: var(--text-secondary);
        }

        .user-dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 8px 0;
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            min-height: calc(100vh - 73px);
        }

        /* Sidebar - Ghost White */
        .sidebar {
            width: 240px;
            background: rgba(248, 248, 255, 0.98);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            padding: 24px 12px;
            overflow-y: auto;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 8px;
            color: #1e293b;
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item:hover {
            background: #f1f5f9;
            color: #3b82f6;
            transform: translateX(4px);
        }

        .nav-item.active {
            background: #eff6ff;
            color: #3b82f6;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-icon.blue { background: rgba(59, 130, 246, 0.1); color: var(--accent-blue); }
        .stat-icon.purple { background: rgba(168, 85, 247, 0.1); color: var(--accent-purple); }
        .stat-icon.green { background: rgba(16, 185, 129, 0.1); color: var(--accent-green); }
        .stat-icon.pink { background: rgba(236, 72, 153, 0.1); color: var(--accent-pink); }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-change {
            font-size: 13px;
            color: var(--accent-green);
            font-weight: 500;
        }

        .stat-change.negative {
            color: #ef4444;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .action-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            text-decoration: none;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .action-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
            border-color: var(--accent-blue);
        }

        .action-icon-wrapper {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .action-icon-wrapper.blue { background: rgba(59, 130, 246, 0.1); color: var(--accent-blue); }
        .action-icon-wrapper.purple { background: rgba(168, 85, 247, 0.1); color: var(--accent-purple); }
        .action-icon-wrapper.green { background: rgba(16, 185, 129, 0.1); color: var(--accent-green); }

        .action-content h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .action-content p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Section */
        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .view-all {
            font-size: 14px;
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 500;
        }

        .view-all:hover {
            text-decoration: underline;
        }

        /* Recent Items Grid */
        .recent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .recent-item {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .recent-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .recent-thumbnail {
            width: 100%;
            height: 140px;
            background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 50%, #d1fae5 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .recent-info {
            padding: 16px;
        }

        .recent-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .recent-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 968px) {
            .sidebar {
                display: none;
            }

            .search-bar {
                margin: 0 16px;
            }

            .main-content {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 3D Background Canvas -->
    <canvas id="canvas3d"></canvas>
    
    <!-- Header -->
    <header class="header">
        <a href="/dashboard/" class="logo">
            <span class="logo-icon">üéµ</span>
            <span>NexGenMusic</span>
        </a>

        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Search music, playlists, or moods...">
        </div>

        <div class="header-actions">
            <button class="icon-btn" title="Notifications">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                </svg>
            </button>
            <div class="user-profile-wrapper">
                <div class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">U</div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-dropdown-header">
                        <div class="user-dropdown-name" id="dropdownUsername">User</div>
                        <div class="user-dropdown-email" id="dropdownEmail">user@nexgenmusic.com</div>
                    </div>
                    <div class="user-dropdown-menu">
                        <a href="/profile/" class="user-dropdown-item">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            <span>My Profile</span>
                        </a>
                        <a href="/settings/" class="user-dropdown-item">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span>Settings</span>
                        </a>
                        <a href="/library/favorites/" class="user-dropdown-item">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                            <span>My Favorites</span>
                        </a>
                        <div class="user-dropdown-divider"></div>
                        <a href="#" class="user-dropdown-item" onclick="logout(); return false;">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="nav-section">
                <div class="nav-section-title">Menu</div>
                <a href="/dashboard/" class="nav-item active">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    <span>Home</span>
                </a>
                <a href="/ai-generator/" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                    </svg>
                    <span>AI Generator</span>
                </a>
                <a href="/spotify-recommendations/" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                    </svg>
                    <span>Spotify</span>
                </a>
                <a href="/history/" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>History</span>
                </a>
            </nav>

            <nav class="nav-section">
                <div class="nav-section-title">Library</div>
                <a href="/library/" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                    <span>My Library</span>
                </a>
                <a href="/library/favorites/" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                    <span>Favorites</span>
                </a>
                <a href="/library/playlists/" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/>
                    </svg>
                    <span>Playlists</span>
                </a>
            </nav>

            <nav class="nav-section">
                <div class="nav-section-title">Account</div>
                <a href="/about/" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>About</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                    <span>Logout</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">Welcome back! üëã</h1>
                <p class="page-subtitle">Here's what's happening with your music today</p>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-label">Total Generated</span>
                        <div class="stat-icon blue">üéµ</div>
                    </div>
                    <div class="stat-value" id="totalGenerated">0</div>
                    <div class="stat-change">+12% from last week</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-label">Listening Time</span>
                        <div class="stat-icon purple">‚è±Ô∏è</div>
                    </div>
                    <div class="stat-value" id="listeningTime">0h</div>
                    <div class="stat-change">+8% from last week</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <span class="stat-label">Favorite Genre</span>
                        <div class="stat-icon green">üé∏</div>
                    </div>
                    <div class="stat-value" id="favoriteGenre" style="font-size: 20px;">Unknown</div>
                    <div class="stat-change">Most played this month</div>
                </div>

                <!-- MOOD WAVE RIDER GAME CARD -->
                <a href="/game/" class="stat-card game-card" style="cursor: pointer; background: #ffffff; border: 2px solid #FF69B4; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3); text-decoration: none; display: block;">
                    <div class="stat-header">
                        <span class="stat-label">Play Mini Game</span>
                        <div class="stat-icon" style="background: linear-gradient(135deg, #FF69B4, #64FFDA); color: white;">üéÆ</div>
                    </div>
                    <div class="stat-value" style="font-size: 20px; background: linear-gradient(135deg, #FF69B4, #64FFDA); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Mood Wave Rider</div>
                    <div class="stat-change" style="color: #FF69B4; font-weight: 600;">üëÜ Click to play! üéµ</div>
                </a>

            </div>

            <!-- Quick Actions -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Quick Actions</h2>
                </div>
                <div class="quick-actions">
                    <a href="/ai-generator/" class="action-card">
                        <div class="action-icon-wrapper purple">‚ú®</div>
                        <div class="action-content">
                            <h3>AI Music Generator</h3>
                            <p>Create music from your mood</p>
                        </div>
                    </a>
                    <a href="/spotify-recommendations/" class="action-card">
                        <div class="action-icon-wrapper green">üéß</div>
                        <div class="action-content">
                            <h3>Spotify Recommendations</h3>
                            <p>Get personalized suggestions</p>
                        </div>
                    </a>
                    <a href="/history/" class="action-card">
                        <div class="action-icon-wrapper blue">üìú</div>
                        <div class="action-content">
                            <h3>Generation History</h3>
                            <p>View your past creations</p>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Recent Generations -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üéµ Recent Generations</h2>
                    <a href="/history/" class="view-all">View all ‚Üí</a>
                </div>
                <div class="recent-grid" id="recentGrid">
                    <!-- Will be populated by JavaScript -->
                    <div class="recent-item">
                        <div class="recent-thumbnail">üéµ</div>
                        <div class="recent-info">
                            <div class="recent-title">Loading...</div>
                            <div class="recent-meta">Please wait</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommended for You -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">‚ú® Recommended for You</h2>
                    <a href="/spotify-recommendations/" class="view-all">View all ‚Üí</a>
                </div>
                <div class="recent-grid" id="recommendedGrid">
                    <div class="recent-item" onclick="window.location.href='/spotify-recommendations/'">
                        <div class="recent-thumbnail" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üåü</div>
                        <div class="recent-info">
                            <div class="recent-title">Discover Weekly</div>
                            <div class="recent-meta">Personalized playlist</div>
                        </div>
                    </div>
                    <div class="recent-item" onclick="window.location.href='/spotify-recommendations/'">
                        <div class="recent-thumbnail" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üî•</div>
                        <div class="recent-info">
                            <div class="recent-title">Trending Now</div>
                            <div class="recent-meta">Popular tracks</div>
                        </div>
                    </div>
                    <div class="recent-item" onclick="window.location.href='/spotify-recommendations/'">
                        <div class="recent-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">üíé</div>
                        <div class="recent-info">
                            <div class="recent-title">Hidden Gems</div>
                            <div class="recent-meta">Curated selection</div>
                        </div>
                    </div>
                    <div class="recent-item" onclick="window.location.href='/ai-generator/'">
                        <div class="recent-thumbnail" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">üé≠</div>
                        <div class="recent-info">
                            <div class="recent-title">Mood Booster</div>
                            <div class="recent-meta">AI-generated music</div>
                        </div>
                    </div>
                    <div class="recent-item" onclick="window.location.href='/spotify-recommendations/'">
                        <div class="recent-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">üé∏</div>
                        <div class="recent-info">
                            <div class="recent-title">Rock Classics</div>
                            <div class="recent-meta">Timeless hits</div>
                        </div>
                    </div>
                    <div class="recent-item" onclick="window.location.href='/spotify-recommendations/'">
                        <div class="recent-thumbnail" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">üéπ</div>
                        <div class="recent-info">
                            <div class="recent-title">Jazz Vibes</div>
                            <div class="recent-meta">Smooth & relaxing</div>
                        </div>
                    </div>
                    <div class="recent-item" onclick="window.location.href='/ai-generator/'">
                        <div class="recent-thumbnail" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">üåà</div>
                        <div class="recent-info">
                            <div class="recent-title">Rainbow Dreams</div>
                            <div class="recent-meta">AI magic</div>
                        </div>
                    </div>
                    <div class="recent-item" onclick="window.location.href='/spotify-recommendations/'">
                        <div class="recent-thumbnail" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">üíñ</div>
                        <div class="recent-info">
                            <div class="recent-title">Love Songs</div>
                            <div class="recent-meta">Romantic collection</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Check authentication (optional - comment out for testing)
        // const token = localStorage.getItem('access_token');
        // if (!token) {
        //     window.location.href = '/premium-login/';
        // }

        // Set user avatar and profile info
        const username = localStorage.getItem('username') || 'User';
        const userEmail = localStorage.getItem('email') || 'user@nexgenmusic.com';
        const userAvatarEl = document.getElementById('userAvatar');
        if (userAvatarEl) {
            userAvatarEl.textContent = username.charAt(0).toUpperCase();
        }
        
        // Update dropdown info
        const dropdownUsername = document.getElementById('dropdownUsername');
        const dropdownEmail = document.getElementById('dropdownEmail');
        if (dropdownUsername) dropdownUsername.textContent = username;
        if (dropdownEmail) dropdownEmail.textContent = userEmail;

        // Toggle user dropdown
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('userDropdown');
            const avatar = document.getElementById('userAvatar');
            if (dropdown && !dropdown.contains(event.target) && event.target !== avatar) {
                dropdown.classList.remove('show');
            }
        });

        // Logout function
        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('username');
            localStorage.removeItem('email');
            window.location.href = '/premium-login/';
        }

        // Fetch dashboard data
        async function fetchDashboardData() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                console.log('No token found, using demo data');
                loadDemoData();
                return;
            }

            try {
                const response = await fetch('/api/history/', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    updateStats(data);
                    updateRecentGenerations(data);
                } else {
                    console.log('Failed to fetch data, using demo data');
                    loadDemoData();
                }
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
                loadDemoData();
            }
        }

        function updateStats(data) {
            if (data && data.length > 0) {
                document.getElementById('totalGenerated').textContent = data.length;
                
                // Calculate listening time (example)
                const totalMinutes = data.length * 3; // Assume 3 min per track
                const hours = Math.floor(totalMinutes / 60);
                document.getElementById('listeningTime').textContent = hours + 'h';

                // Get most common genre
                const genres = data.map(item => item.genre || 'Unknown');
                const genreCount = {};
                genres.forEach(g => genreCount[g] = (genreCount[g] || 0) + 1);
                const favoriteGenre = Object.keys(genreCount).reduce((a, b) => 
                    genreCount[a] > genreCount[b] ? a : b
                );
                document.getElementById('favoriteGenre').textContent = favoriteGenre;
            }
        }

        function updateRecentGenerations(data) {
            const recentGrid = document.getElementById('recentGrid');
            if (!data || data.length === 0) {
                loadDemoData();
                return;
            }

            // Get mood emoji
            const moodEmojis = {
                'happy': 'üòä',
                'sad': 'üò¢',
                'energetic': '‚ö°',
                'calm': 'üòå',
                'romantic': '‚ù§Ô∏è',
                'angry': 'üò†'
            };

            // Take last 8 items
            const recentItems = data.slice(-8).reverse();
            
            recentGrid.innerHTML = recentItems.map(item => {
                const emoji = moodEmojis[item.mood] || 'üéµ';
                const timeAgo = getTimeAgo(item.created_at);
                
                return `
                    <div class="recent-item" onclick="playAudio('${item.audio_url}')">
                        <div class="recent-thumbnail">${emoji}</div>
                        <div class="recent-info">
                            <div class="recent-title">${item.mood} ${item.genre || 'Music'}</div>
                            <div class="recent-meta">${timeAgo}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' minutes ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
            if (seconds < 604800) return Math.floor(seconds / 86400) + ' days ago';
            return Math.floor(seconds / 604800) + ' weeks ago';
        }

        function playAudio(url) {
            if (url) {
                window.open(url, '_blank');
            }
        }

        function loadDemoData() {
            const demoData = [
                { mood: 'happy', genre: 'Pop', created_at: new Date(Date.now() - 2 * 3600000).toISOString() },
                { mood: 'calm', genre: 'Jazz', created_at: new Date(Date.now() - 5 * 3600000).toISOString() },
                { mood: 'energetic', genre: 'Rock', created_at: new Date(Date.now() - 86400000).toISOString() },
                { mood: 'romantic', genre: 'Classical', created_at: new Date(Date.now() - 2 * 86400000).toISOString() },
                { mood: 'happy', genre: 'Electronic', created_at: new Date(Date.now() - 3 * 86400000).toISOString() },
                { mood: 'sad', genre: 'Ambient', created_at: new Date(Date.now() - 4 * 86400000).toISOString() },
                { mood: 'energetic', genre: 'Hip Hop', created_at: new Date(Date.now() - 5 * 86400000).toISOString() },
                { mood: 'calm', genre: 'Classical', created_at: new Date(Date.now() - 6 * 86400000).toISOString() }
            ];
            
            updateRecentGenerations(demoData);
            
            // Update stats with demo data
            document.getElementById('totalGenerated').textContent = '24';
            document.getElementById('listeningTime').textContent = '12h';
            document.getElementById('favoriteGenre').textContent = 'Pop';
            document.getElementById('totalPlaylists').textContent = '8';
        }

        // Load data on page load
        fetchDashboardData();
        
    </script>

    <!-- 3D Background Animation Script -->
    
    <script src="/static/js/3d-background-premium.js"></script>
    
    <!-- Mood Wave Rider Game Script -->
    <script src="/static/js/mood-wave-rider.js"></script>

    <script>
    // Mood Wave Rider Game Modal Functions
    function openMoodWaveRider() {
        console.log('üéÆ Opening Mood Wave Rider game...');
        
        const gameModal = document.createElement('div');
        gameModal.id = 'game-modal';
        gameModal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        `;
        
        console.log('‚úÖ Modal element created');

        gameModal.innerHTML = `
            <div style="position: relative; width: 95%; max-width: 1000px; height: 90vh; max-height: 700px;">
                <button onclick="closeMoodWaveRider()" style="
                    position: absolute;
                    top: -50px;
                    right: 0;
                    background: rgba(255, 255, 255, 0.95);
                    border: none;
                    border-radius: 50%;
                    width: 45px;
                    height: 45px;
                    font-size: 28px;
                    cursor: pointer;
                    color: #FF69B4;
                    box-shadow: 0 4px 16px rgba(255, 105, 180, 0.4);
                    transition: all 0.3s ease;
                    z-index: 10001;
                    font-weight: bold;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                " onmouseover="this.style.transform='scale(1.15) rotate(90deg)'; this.style.background='#FF69B4'; this.style.color='white';" onmouseout="this.style.transform='scale(1) rotate(0deg)'; this.style.background='rgba(255, 255, 255, 0.95)'; this.style.color='#FF69B4';">√ó</button>
                
                <div id="mood-wave-rider" style="height: 100%; margin: 0; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 240, 245, 0.9)); border-radius: 16px; overflow: hidden;">
                    <div class="game-header" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; background: linear-gradient(90deg, rgba(255, 182, 193, 0.3), rgba(176, 224, 230, 0.3)); border-bottom: 2px solid rgba(255, 105, 180, 0.2);">
                        <div class="game-title" style="font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, #FF69B4, #64FFDA); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">üéÆ Mood Wave Rider</div>
                        <div class="game-controls" style="display: flex; gap: 0.5rem; align-items: center;">
                            <div class="game-score" style="font-size: 1.2rem; font-weight: 600; color: #FF69B4; padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.8); border-radius: 12px;">Score: <span id="score-value">0</span></div>
                        </div>
                    </div>
                    <div class="game-container" style="position: relative; width: 100%; height: calc(100% - 70px); overflow: hidden;">
                        <canvas id="game-canvas" style="display: block; width: 100%; height: 100%; background: linear-gradient(180deg, rgba(255, 250, 250, 1) 0%, rgba(255, 240, 245, 0.9) 50%, rgba(240, 255, 255, 0.9) 100%);"></canvas>
                        <div id="game-overlay" class="game-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); z-index: 10; transition: opacity 0.3s ease;">
                            <div id="menu-screen" class="overlay-content" style="text-align: center; padding: 2rem;">
                                <div class="overlay-title" style="font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, #FF69B4, #64FFDA, #00CED1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;">üéµ Mood Wave Rider üéµ</div>
                                <div class="overlay-subtitle" style="font-size: 1.2rem; color: #666; margin-bottom: 2rem;">Ride the sound wave and avoid the spikes!</div>
                                <button id="start-btn" class="play-btn" style="padding: 1rem 3rem; font-size: 1.3rem; background: linear-gradient(135deg, #FF69B4, #FF1493); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: 700; box-shadow: 0 8px 24px rgba(255, 105, 180, 0.4); transition: all 0.3s ease;">‚ñ∂ Start Game</button>
                                <div class="game-instructions" style="margin-top: 1rem; padding: 1rem; background: rgba(100, 255, 218, 0.1); border-radius: 12px; border: 1px solid rgba(100, 255, 218, 0.3);">
                                    <p style="margin: 0.5rem 0; color: #555; font-size: 1rem;"><strong>Controls:</strong> Arrow Keys or A/D to move</p>
                                    <p style="margin: 0.5rem 0; color: #555; font-size: 1rem;"><strong>Goal:</strong> Survive as long as possible!</p>
                                    <p style="margin: 0.5rem 0; color: #555; font-size: 1rem;"><strong>Tip:</strong> The wave pulses with the beat üé∂</p>
                                </div>
                            </div>
                            <div id="countdown-screen" class="overlay-content" style="display: none; text-align: center; padding: 2rem;">
                                <div class="countdown" id="countdown-number" style="font-size: 5rem; font-weight: 700; background: linear-gradient(135deg, #FF69B4, #64FFDA); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">3</div>
                            </div>
                            <div id="gameover-screen" class="overlay-content game-over-content" style="display: none; text-align: center; padding: 2rem;">
                                <div class="overlay-title" style="font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, #FF69B4, #64FFDA, #00CED1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem;">üí• Game Over! üí•</div>
                                <div class="final-score" id="final-score" style="font-size: 3rem; font-weight: 700; color: #FF69B4; margin: 1rem 0;">0</div>
                                <div class="overlay-subtitle" style="font-size: 1.2rem; color: #666; margin-bottom: 2rem;">points survived!</div>
                                <button id="play-again-btn" class="play-btn" style="padding: 1rem 3rem; font-size: 1.3rem; background: linear-gradient(135deg, #FF69B4, #FF1493); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: 700; box-shadow: 0 8px 24px rgba(255, 105, 180, 0.4); transition: all 0.3s ease;">üîÑ Play Again</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        document.body.appendChild(gameModal);
        console.log('‚úÖ Modal added to page');

        if (!document.getElementById('game-css')) {
            const link = document.createElement('link');
            link.id = 'game-css';
            link.rel = 'stylesheet';
            link.href = '/static/css/mood-wave-rider.css';
            document.head.appendChild(link);
            console.log('‚úÖ CSS loaded');
        }

        // Wait for modal to be rendered, then initialize game
        setTimeout(() => {
            if (window.MoodWaveRider) {
                console.log('‚úÖ Initializing game...');
                try {
                    window.currentGame = new MoodWaveRider('mood-wave-rider');
                    console.log('üéÆ Game ready! Click "Start Game" to play.');
                } catch (error) {
                    console.error('‚ùå Error initializing game:', error);
                }
            } else {
                console.error('‚ùå MoodWaveRider class not found. Make sure /static/js/mood-wave-rider.js is loaded.');
            }
        }, 200);
    }

    function closeMoodWaveRider() {
        const modal = document.getElementById('game-modal');
        if (modal) {
            if (window.currentGame && window.currentGame.animationId) {
                cancelAnimationFrame(window.currentGame.animationId);
                window.currentGame = null;
            }
            modal.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => modal.remove(), 300);
        }
    }

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeMoodWaveRider();
    });

    const gameStyle = document.createElement('style');
    gameStyle.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }
        .game-card:hover {
            transform: translateY(-6px) scale(1.03) !important;
            box-shadow: 0 12px 32px rgba(255, 105, 180, 0.4) !important;
        }
        .game-card:active {
            transform: translateY(-4px) scale(1.01) !important;
        }
    `;
    document.head.appendChild(gameStyle);
    </script>

</body>
</html>

    <script>
        // ========== ULTRA-PREMIUM 3D SCENE ==========
        let scene, camera, renderer;
        let peacock, deer, birds = [];
        let emojis = [];
        let waveform;
        let mouse = { x: 0, y: 0 };
        let isLiteMode = false;
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        function init3DScene() {
            const canvas = document.getElementById('canvas3d');
            
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe0e7ff);
            scene.fog = new THREE.Fog(0xe0e7ff, 20, 60);

            // Camera
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 4, 18);
            camera.lookAt(0, 2, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);

            const directionalLight1 = new THREE.DirectionalLight(0xa5b4fc, 1.2);
            directionalLight1.position.set(10, 15, 10);
            directionalLight1.castShadow = true;
            directionalLight1.shadow.mapSize.width = 2048;
            directionalLight1.shadow.mapSize.height = 2048;
            scene.add(directionalLight1);

            const directionalLight2 = new THREE.DirectionalLight(0xfae8ff, 0.8);
            directionalLight2.position.set(-10, 10, -5);
            scene.add(directionalLight2);

            const pointLight = new THREE.PointLight(0xd1fae5, 0.6, 50);
            pointLight.position.set(0, 8, 5);
            scene.add(pointLight);

            // Create scene elements
            createGround();
            createPeacock();
            createDeer();
            createBirds();
            createFloatingEmojis();
            createWaveform();
            createParticles();
            createVolumetricLights();

            // Event listeners
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            
            // Form interactions
            setupFormInteractions();

            // Start animation
            animate();
        }

        function createGround() {
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshStandardMaterial({
                color: 0xdbeafe,
                roughness: 0.8,
                metalness: 0.1
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = 0;
            ground.receiveShadow = true;
            scene.add(ground);
        }

        function createPeacock() {
            const peacockGroup = new THREE.Group();

            // Body
            const bodyGeometry = new THREE.SphereGeometry(0.8, 20, 20);
            const bodyMaterial = new THREE.MeshStandardMaterial({
                color: 0xa5b4fc,
                roughness: 0.3,
                metalness: 0.2
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.scale.set(1, 1.3, 0.9);
            body.castShadow = true;
            peacockGroup.add(body);

            // Head
            const headGeometry = new THREE.SphereGeometry(0.45, 16, 16);
            const headMaterial = new THREE.MeshStandardMaterial({ color: 0xc7d2fe });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.set(0, 1, 0.4);
            head.castShadow = true;
            peacockGroup.add(head);

            // Beak
            const beakGeometry = new THREE.ConeGeometry(0.1, 0.25, 8);
            const beakMaterial = new THREE.MeshStandardMaterial({ color: 0xfbbf24 });
            const beak = new THREE.Mesh(beakGeometry, beakMaterial);
            beak.position.set(0, 1, 0.75);
            beak.rotation.x = Math.PI / 2;
            peacockGroup.add(beak);

            // Eyes
            const eyeGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x1e293b });
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.2, 1.1, 0.65);
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.2, 1.1, 0.65);
            peacockGroup.add(leftEye, rightEye);

            // Tail feathers (glowing)
            const featherGroup = new THREE.Group();
            for (let i = 0; i < 11; i++) {
                const angle = (i - 5) * 0.22;
                const featherGeometry = new THREE.PlaneGeometry(0.5, 2);
                const featherMaterial = new THREE.MeshStandardMaterial({
                    color: i % 2 === 0 ? 0x6366f1 : 0xa855f7,
                    side: THREE.DoubleSide,
                    emissive: i % 2 === 0 ? 0x6366f1 : 0xa855f7,
                    emissiveIntensity: 0.4,
                    transparent: true,
                    opacity: 0.95
                });
                const feather = new THREE.Mesh(featherGeometry, featherMaterial);
                feather.position.set(Math.sin(angle) * 1.2, 0.8, -0.6 + Math.cos(angle) * 0.4);
                feather.rotation.y = angle;
                featherGroup.add(feather);
            }
            peacockGroup.add(featherGroup);
            peacockGroup.userData.feathers = featherGroup;

            peacockGroup.position.set(-10, 0.8, 2);
            peacockGroup.userData.baseY = 0.8;
            peacockGroup.userData.time = 0;
            peacockGroup.scale.set(1.8, 1.8, 1.8);
            
            scene.add(peacockGroup);
            peacock = peacockGroup;
        }

        function createDeer() {
            const deerGroup = new THREE.Group();

            // Body
            const bodyGeometry = new THREE.BoxGeometry(1, 0.8, 1.5);
            const bodyMaterial = new THREE.MeshStandardMaterial({
                color: 0xfed7aa,
                roughness: 0.5
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.castShadow = true;
            deerGroup.add(body);

            // Head
            const headGeometry = new THREE.BoxGeometry(0.6, 0.6, 0.8);
            const head = new THREE.Mesh(headGeometry, bodyMaterial);
            head.position.set(0, 0.5, 1);
            head.castShadow = true;
            deerGroup.add(head);

            // Snout
            const snoutGeometry = new THREE.BoxGeometry(0.4, 0.25, 0.4);
            const snout = new THREE.Mesh(snoutGeometry, bodyMaterial);
            snout.position.set(0, 0.4, 1.5);
            deerGroup.add(snout);

            // Nose
            const noseGeometry = new THREE.SphereGeometry(0.1, 8, 8);
            const noseMaterial = new THREE.MeshStandardMaterial({ color: 0x1e293b });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.position.set(0, 0.4, 1.7);
            deerGroup.add(nose);

            // Eyes
            const eyeGeometry = new THREE.SphereGeometry(0.12, 8, 8);
            const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x1e293b });
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.2, 0.6, 1.3);
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.2, 0.6, 1.3);
            deerGroup.add(leftEye, rightEye);

            // Ears
            const earGeometry = new THREE.ConeGeometry(0.2, 0.5, 8);
            const leftEar = new THREE.Mesh(earGeometry, bodyMaterial);
            leftEar.position.set(-0.3, 0.9, 1);
            leftEar.rotation.z = -0.3;
            const rightEar = new THREE.Mesh(earGeometry, bodyMaterial);
            rightEar.position.set(0.3, 0.9, 1);
            rightEar.rotation.z = 0.3;
            deerGroup.add(leftEar, rightEar);
            deerGroup.userData.ears = [leftEar, rightEar];

            // Antlers
            const antlerMaterial = new THREE.MeshStandardMaterial({ color: 0x92400e });
            const antlerGeometry = new THREE.CylinderGeometry(0.04, 0.06, 0.6, 8);
            const leftAntler = new THREE.Mesh(antlerGeometry, antlerMaterial);
            leftAntler.position.set(-0.25, 1.1, 0.9);
            const rightAntler = new THREE.Mesh(antlerGeometry, antlerMaterial);
            rightAntler.position.set(0.25, 1.1, 0.9);
            deerGroup.add(leftAntler, rightAntler);

            // Legs
            const legGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.8, 8);
            const positions = [[-0.4, -0.8, 0.5], [0.4, -0.8, 0.5], [-0.4, -0.8, -0.5], [0.4, -0.8, -0.5]];
            positions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, bodyMaterial);
                leg.position.set(...pos);
                leg.castShadow = true;
                deerGroup.add(leg);
            });

            deerGroup.position.set(10, 1.2, 2);
            deerGroup.userData.baseY = 1.2;
            deerGroup.userData.time = 0;
            deerGroup.scale.set(1.5, 1.5, 1.5);
            
            scene.add(deerGroup);
            deer = deerGroup;
        }

        function createBirds() {
            const colors = [0x93c5fd, 0xbfdbfe, 0xdbeafe];
            for (let i = 0; i < 5; i++) {
                const birdGroup = new THREE.Group();

                // Body
                const bodyGeometry = new THREE.SphereGeometry(0.2, 12, 12);
                const bodyMaterial = new THREE.MeshStandardMaterial({
                    color: colors[i % 3],
                    roughness: 0.4
                });
                const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                body.scale.set(1, 0.8, 1.2);
                body.castShadow = true;
                birdGroup.add(body);

                // Head
                const headGeometry = new THREE.SphereGeometry(0.12, 12, 12);
                const head = new THREE.Mesh(headGeometry, bodyMaterial);
                head.position.set(0, 0.15, 0.2);
                birdGroup.add(head);

                // Beak
                const beakGeometry = new THREE.ConeGeometry(0.04, 0.1, 6);
                const beakMaterial = new THREE.MeshStandardMaterial({ color: 0xfbbf24 });
                const beak = new THREE.Mesh(beakGeometry, beakMaterial);
                beak.position.set(0, 0.15, 0.32);
                beak.rotation.x = Math.PI / 2;
                birdGroup.add(beak);

                // Wings
                const wingGeometry = new THREE.BoxGeometry(0.4, 0.05, 0.2);
                const leftWing = new THREE.Mesh(wingGeometry, bodyMaterial);
                leftWing.position.set(-0.25, 0, 0);
                const rightWing = new THREE.Mesh(wingGeometry, bodyMaterial);
                rightWing.position.set(0.25, 0, 0);
                birdGroup.add(leftWing, rightWing);
                birdGroup.userData.wings = [leftWing, rightWing];

                // Position in circular path
                const angle = (i / 5) * Math.PI * 2;
                const radius = 8;
                birdGroup.position.set(
                    Math.cos(angle) * radius,
                    5 + Math.sin(i) * 2,
                    Math.sin(angle) * radius
                );
                birdGroup.userData.angle = angle;
                birdGroup.userData.radius = radius;
                birdGroup.userData.time = i * 0.5;

                scene.add(birdGroup);
                birds.push(birdGroup);
            }
        }

        function createFloatingEmojis() {
            const emojiTexts = ['üéµ', 'üéß', 'üîä', '‚≠ê', '‚ù§Ô∏è', 'üî•', 'üåà'];
            const emojiMaterial = new THREE.MeshStandardMaterial({
                color: 0xffffff,
                emissive: 0xffffff,
                emissiveIntensity: 0.3,
                transparent: true,
                opacity: 0.9
            });

            for (let i = 0; i < 30; i++) {
                const emojiGroup = new THREE.Group();
                
                // Create emoji as a simple sphere with color
                const geometry = new THREE.SphereGeometry(0.3, 16, 16);
                const colors = [0xfbbf24, 0xec4899, 0xa855f7, 0x6366f1, 0x10b981, 0xf59e0b, 0x8b5cf6];
                const material = new THREE.MeshStandardMaterial({
                    color: colors[i % colors.length],
                    emissive: colors[i % colors.length],
                    emissiveIntensity: 0.4,
                    transparent: true,
                    opacity: 0.8
                });
                const emoji = new THREE.Mesh(geometry, material);
                emojiGroup.add(emoji);

                // Random position in foreground
                emojiGroup.position.set(
                    (Math.random() - 0.5) * 30,
                    Math.random() * 10 + 2,
                    Math.random() * 15 + 5
                );
                emojiGroup.userData.baseY = emojiGroup.position.y;
                emojiGroup.userData.speed = 0.5 + Math.random() * 0.5;
                emojiGroup.userData.time = Math.random() * Math.PI * 2;

                scene.add(emojiGroup);
                emojis.push(emojiGroup);
            }
        }

        function createWaveform() {
            const waveformGroup = new THREE.Group();
            const barCount = 20;
            const bars = [];

            for (let i = 0; i < barCount; i++) {
                const height = 1 + Math.random() * 3;
                const geometry = new THREE.BoxGeometry(0.3, height, 0.3);
                const material = new THREE.MeshStandardMaterial({
                    color: 0x6366f1,
                    emissive: 0x6366f1,
                    emissiveIntensity: 0.5,
                    transparent: true,
                    opacity: 0.8
                });
                const bar = new THREE.Mesh(geometry, material);
                bar.position.set((i - barCount / 2) * 0.5, height / 2, 0);
                bar.userData.baseHeight = height;
                waveformGroup.add(bar);
                bars.push(bar);
            }

            waveformGroup.position.set(0, 0, -10);
            waveformGroup.userData.bars = bars;
            scene.add(waveformGroup);
            waveform = waveformGroup;
        }

        function createParticles() {
            const particleCount = 200;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(particleCount * 3);
            const colors = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 50;
                positions[i * 3 + 1] = Math.random() * 20;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 50;

                const color = new THREE.Color();
                color.setHSL(Math.random() * 0.3 + 0.5, 0.7, 0.7);
                colors[i * 3] = color.r;
                colors[i * 3 + 1] = color.g;
                colors[i * 3 + 2] = color.b;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 0.15,
                vertexColors: true,
                transparent: true,
                opacity: 0.6,
                blending: THREE.AdditiveBlending
            });

            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
        }

        function createVolumetricLights() {
            // Floating rings
            for (let i = 0; i < 3; i++) {
                const ringGeometry = new THREE.TorusGeometry(2 + i, 0.1, 16, 100);
                const ringMaterial = new THREE.MeshStandardMaterial({
                    color: [0xa5b4fc, 0xd8b4fe, 0xfed7aa][i],
                    emissive: [0xa5b4fc, 0xd8b4fe, 0xfed7aa][i],
                    emissiveIntensity: 0.5,
                    transparent: true,
                    opacity: 0.3
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.position.set(0, 8 + i * 2, -15);
                ring.rotation.x = Math.PI / 2;
                scene.add(ring);
            }
        }

        function setupFormInteractions() {
            const usernameInput = document.getElementById('username');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const registerForm = document.getElementById('registerForm');
            const registerButton = document.querySelector('.btn-primary');

            // Input focus - waveform pulse
            [usernameInput, emailInput, passwordInput, confirmPasswordInput].forEach(input => {
                input.addEventListener('focus', () => {
                    if (waveform && !prefersReducedMotion) {
                        waveform.userData.pulsing = true;
                        // Deer ears move
                        if (deer && deer.userData.ears) {
                            deer.userData.ears.forEach(ear => {
                                ear.rotation.z += ear.rotation.z > 0 ? 0.2 : -0.2;
                            });
                        }
                    }
                });

                input.addEventListener('blur', () => {
                    if (waveform) {
                        waveform.userData.pulsing = false;
                    }
                });

                // Typing - waveform reacts
                input.addEventListener('input', () => {
                    if (waveform && waveform.userData.bars && !prefersReducedMotion) {
                        waveform.userData.bars.forEach((bar, i) => {
                            const randomHeight = 1 + Math.random() * 4;
                            bar.scale.y = randomHeight / bar.userData.baseHeight;
                        });
                    }
                });
            });

            // Button hover - animals react
            registerButton.addEventListener('mouseenter', () => {
                if (!prefersReducedMotion) {
                    // Peacock feathers brighten
                    if (peacock && peacock.userData.feathers) {
                        peacock.userData.feathers.children.forEach(feather => {
                            feather.material.emissiveIntensity = 0.7;
                        });
                    }
                    // Deer hops
                    if (deer) {
                        deer.userData.hopping = true;
                    }
                }
            });

            registerButton.addEventListener('mouseleave', () => {
                if (peacock && peacock.userData.feathers) {
                    peacock.userData.feathers.children.forEach(feather => {
                        feather.material.emissiveIntensity = 0.4;
                    });
                }
                if (deer) {
                    deer.userData.hopping = false;
                }
            });

            // Form submit - success animation
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const username = usernameInput.value;
                const email = emailInput.value;
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                
                // Validate passwords match
                if (password !== confirmPassword) {
                    alert('Passwords do not match!');
                    return;
                }
                
                // Disable button during submission
                registerButton.disabled = true;
                registerButton.textContent = 'Creating Account...';
                
                try {
                    const response = await fetch('/api/register/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ username, email, password })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Store tokens
                        localStorage.setItem('access_token', data.access);
                        localStorage.setItem('refresh_token', data.refresh);
                        
                        // Trigger success animation
                        if (!prefersReducedMotion) {
                            if (peacock) {
                                peacock.userData.spinning = true;
                            }
                            emojis.forEach(emoji => {
                                emoji.userData.blooming = true;
                            });
                        }
                        
                        // Redirect to dashboard after animation
                        setTimeout(() => {
                            window.location.href = '/dashboard/';
                        }, 1500);
                    } else {
                        // Show error
                        alert(data.error || 'Registration failed. Please try again.');
                        registerButton.disabled = false;
                        registerButton.textContent = 'Create Account';
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    alert('Network error. Please try again.');
                    registerButton.disabled = false;
                    registerButton.textContent = 'Create Account';
                }
            });
        }

        // Helper function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // Camera parallax
            if (!prefersReducedMotion) {
                camera.position.x = mouse.x * 2;
                camera.position.y = 5 + mouse.y * 1;
                camera.lookAt(0, 3, 0);
            }

            // Emojis react to pointer proximity
            emojis.forEach(emoji => {
                const dx = emoji.position.x - mouse.x * 20;
                const dy = emoji.position.y - (5 + mouse.y * 10);
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 5 && !prefersReducedMotion) {
                    emoji.userData.accelerated = true;
                    emoji.scale.set(1.3, 1.3, 1.3);
                } else {
                    emoji.userData.accelerated = false;
                    emoji.scale.set(1, 1, 1);
                }
            });
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            const time = Date.now() * 0.001;

            if (!prefersReducedMotion && !isLiteMode) {
                // Peacock animation
                if (peacock) {
                    peacock.userData.time += 0.01;
                    peacock.position.y = peacock.userData.baseY + Math.sin(peacock.userData.time) * 0.2;
                    peacock.rotation.y = Math.sin(peacock.userData.time * 0.5) * 0.3;
                    
                    // Feather sway
                    if (peacock.userData.feathers) {
                        peacock.userData.feathers.rotation.y = Math.sin(time * 0.8) * 0.2;
                    }

                    // Spinning animation on submit
                    if (peacock.userData.spinning) {
                        peacock.rotation.y += 0.1;
                        if (peacock.rotation.y > Math.PI * 2) {
                            peacock.userData.spinning = false;
                            peacock.rotation.y = 0;
                        }
                    }
                }

                // Deer animation
                if (deer) {
                    deer.userData.time += 0.01;
                    // Gentle head-bob
                    deer.rotation.x = Math.sin(deer.userData.time * 2) * 0.05;
                    
                    // Hopping
                    if (deer.userData.hopping) {
                        deer.position.y = deer.userData.baseY + Math.abs(Math.sin(time * 8)) * 0.5;
                    } else {
                        deer.position.y = deer.userData.baseY + Math.sin(deer.userData.time) * 0.1;
                    }
                }

                // Birds animation
                birds.forEach((bird, i) => {
                    bird.userData.time += 0.01;
                    bird.userData.angle += 0.005;
                    bird.position.x = Math.cos(bird.userData.angle) * bird.userData.radius;
                    bird.position.z = Math.sin(bird.userData.angle) * bird.userData.radius;
                    bird.position.y = 5 + Math.sin(bird.userData.time * 2) * 1;
                    bird.lookAt(
                        Math.cos(bird.userData.angle + 0.1) * bird.userData.radius,
                        bird.position.y,
                        Math.sin(bird.userData.angle + 0.1) * bird.userData.radius
                    );

                    // Wing flapping
                    if (bird.userData.wings) {
                        const flapAngle = Math.sin(time * 10 + i) * 0.5;
                        bird.userData.wings[0].rotation.z = flapAngle;
                        bird.userData.wings[1].rotation.z = -flapAngle;
                    }
                });

                // Emojis animation
                emojis.forEach((emoji, i) => {
                    emoji.userData.time += emoji.userData.speed * 0.01;
                    emoji.position.y = emoji.userData.baseY + Math.sin(emoji.userData.time) * 0.5;
                    emoji.rotation.y += 0.02;
                    emoji.rotation.x = Math.sin(emoji.userData.time * 0.5) * 0.3;

                    // Accelerate on mouse proximity
                    if (emoji.userData.accelerated) {
                        emoji.rotation.y += 0.05;
                    }

                    // Bloom animation on submit
                    if (emoji.userData.blooming) {
                        emoji.position.x += (emoji.position.x > 0 ? 0.2 : -0.2);
                        emoji.position.z += 0.2;
                        emoji.scale.multiplyScalar(1.02);
                        if (emoji.scale.x > 2) {
                            emoji.userData.blooming = false;
                        }
                    }
                });

                // Waveform animation
                if (waveform && waveform.userData.bars) {
                    waveform.userData.bars.forEach((bar, i) => {
                        if (waveform.userData.pulsing) {
                            bar.scale.y = 1 + Math.sin(time * 5 + i * 0.5) * 0.5;
                        } else {
                            bar.scale.y = 1 + Math.sin(time * 2 + i * 0.3) * 0.2;
                        }
                    });
                }
            }

            renderer.render(scene, camera);
        }

        // About Modal
        const aboutBtn = document.getElementById('aboutBtn');
        const aboutModal = document.getElementById('aboutModal');
        const closeModal = document.getElementById('closeModal');

        aboutBtn.addEventListener('click', () => {
            aboutModal.classList.add('show');
        });

        closeModal.addEventListener('click', () => {
            aboutModal.classList.remove('show');
        });

        // Close modal when clicking outside
        aboutModal.addEventListener('click', (e) => {
            if (e.target === aboutModal) {
                aboutModal.classList.remove('show');
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && aboutModal.classList.contains('show')) {
                aboutModal.classList.remove('show');
            }
        });

        // Initialize
        if (!prefersReducedMotion) {
            init3DScene();
    </script>
