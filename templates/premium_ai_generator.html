<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Music Generator - NexGenMusic</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
{% include 'includes/premium_header_sidebar.html' %}

<style>
    .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 32px;
    }

    .page-title {
        font-size: 28px;
        font-weight: 700;
        color: var(--text-primary);
    }

    .page-subtitle {
        font-size: 14px;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    /* Generator Card */
    .generator-card {
        background: white;
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-color);
        padding: 32px;
        margin-bottom: 24px;
    }

    .input-group {
        margin-bottom: 24px;
    }

    .input-label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-primary);
        font-size: 14px;
    }

    .input-field, .select-field {
        width: 100%;
        padding: 14px 16px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 14px;
        font-family: 'Inter', sans-serif;
        transition: all 0.2s ease;
        background: white;
        color: var(--text-primary);
    }

    .input-field:focus, .select-field:focus {
        outline: none;
        border-color: var(--primary-green);
        box-shadow: 0 0 0 3px rgba(27, 94, 32, 0.1);
    }

    .input-field::placeholder {
        color: var(--text-muted);
    }

    /* Mood Chips */
    .mood-chips {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 12px;
    }

    .mood-chip {
        padding: 10px 18px;
        background: var(--bg-main);
        border: 1px solid var(--border-color);
        border-radius: 24px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
        font-weight: 500;
        color: var(--text-secondary);
    }

    .mood-chip:hover {
        background: #F0FDF4;
        border-color: var(--primary-green);
        color: var(--primary-green);
        transform: translateY(-2px);
    }

    .mood-chip.active {
        background: var(--primary-green);
        border-color: var(--primary-green);
        color: white;
    }

    /* Generate Button */
    .btn-generate {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-green-light) 100%);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .btn-generate:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(27, 94, 32, 0.3);
    }

    .btn-generate:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }

    /* Player Section */
    .player-section {
        background: white;
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-color);
        padding: 32px;
        margin-top: 24px;
    }

    .player-header {
        text-align: center;
        margin-bottom: 24px;
    }

    .player-title {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 16px;
        color: var(--primary-green);
    }

    .player-info {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .info-badge {
        padding: 6px 16px;
        background: #F0FDF4;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
        color: var(--primary-green);
    }

    /* Waveform Animation */
    .waveform {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        height: 80px;
        margin: 24px 0;
    }

    .wave-bar {
        width: 4px;
        background: linear-gradient(180deg, var(--primary-green) 0%, var(--accent-green) 100%);
        border-radius: 4px;
        animation: wave 1s ease-in-out infinite;
    }

    .wave-bar:nth-child(1) { animation-delay: 0s; }
    .wave-bar:nth-child(2) { animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { animation-delay: 0.3s; }
    .wave-bar:nth-child(5) { animation-delay: 0.4s; }
    .wave-bar:nth-child(6) { animation-delay: 0.3s; }
    .wave-bar:nth-child(7) { animation-delay: 0.2s; }
    .wave-bar:nth-child(8) { animation-delay: 0.1s; }

    @keyframes wave {
        0%, 100% { height: 20px; }
        50% { height: 60px; }
    }

    /* Audio Player */
    .audio-player-wrapper {
        margin: 24px 0;
    }

    .audio-player {
        width: 100%;
        border-radius: 8px;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 24px;
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: var(--radius-md);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-success {
        background: var(--primary-green);
        color: white;
    }

    .btn-success:hover {
        background: var(--primary-green-light);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(27, 94, 32, 0.3);
    }

    .btn-secondary {
        background: var(--bg-main);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
        border-color: var(--primary-green);
        color: var(--primary-green);
        transform: translateY(-2px);
    }

    .btn-primary {
        background: var(--primary-green);
        color: white;
    }

    .btn-primary:hover {
        background: var(--primary-green-light);
        transform: translateY(-2px);
    }

    /* Loading Spinner */
    .loading-spinner {
        width: 24px;
        height: 24px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Two Column Layout */
    .generator-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
    }

    .generator-grid .input-group:last-child {
        margin-bottom: 0;
    }

    /* Quick Tips Card */
    .tips-card {
        background: linear-gradient(135deg, var(--primary-green-dark) 0%, var(--primary-green) 100%);
        border-radius: var(--radius-lg);
        padding: 24px;
        color: white;
        margin-bottom: 24px;
    }

    .tips-card h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .tips-list {
        list-style: none;
        font-size: 14px;
        opacity: 0.9;
    }

    .tips-list li {
        padding: 6px 0;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    @media (max-width: 768px) {
        .generator-grid {
            grid-template-columns: 1fr;
        }
        .generator-card {
            padding: 24px;
        }
        .mood-chips {
            gap: 8px;
        }
        .mood-chip {
            padding: 8px 14px;
            font-size: 13px;
        }
    }
</style>

<div class="page-header">
    <div>
        <h1 class="page-title">AI Music Generator</h1>
        <p class="page-subtitle">Create personalized music based on your emotions and preferences.</p>
    </div>
</div>

<!-- Tips Card -->
<div class="tips-card">
    <h3>üí° Quick Tips</h3>
    <ul class="tips-list">
        <li>‚úì Select a mood that matches your current feeling</li>
        <li>‚úì Choose tempo based on your activity (slow for relaxing, fast for workout)</li>
        <li>‚úì Experiment with different genres for unique results</li>
    </ul>
</div>

<!-- Generator Card -->
<div class="generator-card">
    <div class="input-group">
        <label class="input-label">üéµ Track Title</label>
        <input type="text" class="input-field" id="titleInput" placeholder="e.g., My Happy Song, Chill Vibes...">
    </div>

    <div class="input-group">
        <label class="input-label">üé≠ Select Your Mood</label>
        <input type="text" class="input-field" id="moodInput" placeholder="Type or select a mood below...">
        <div class="mood-chips">
            <button class="mood-chip" data-mood="Happy">üòä Happy</button>
            <button class="mood-chip" data-mood="Sad">üò¢ Sad</button>
            <button class="mood-chip" data-mood="Energetic">‚ö° Energetic</button>
            <button class="mood-chip" data-mood="Chill">üòå Chill</button>
            <button class="mood-chip" data-mood="Romantic">‚ù§Ô∏è Romantic</button>
            <button class="mood-chip" data-mood="Angry">üò† Angry</button>
            <button class="mood-chip" data-mood="Focus">üéØ Focus</button>
            <button class="mood-chip" data-mood="Peaceful">üåø Peaceful</button>
        </div>
    </div>

    <div class="generator-grid">
        <div class="input-group">
            <label class="input-label">üéº Tempo Preference</label>
            <select class="select-field" id="tempoInput">
                <option value="slow">üê¢ Slow (60-80 BPM)</option>
                <option value="medium" selected>üö∂ Medium (80-120 BPM)</option>
                <option value="fast">üèÉ Fast (120-180 BPM)</option>
            </select>
        </div>

        <div class="input-group">
            <label class="input-label">üé∏ Genre</label>
            <select class="select-field" id="genreInput">
                <option value="">Any Genre</option>
                <option value="pop">Pop</option>
                <option value="rock">Rock</option>
                <option value="electronic">Electronic</option>
                <option value="jazz">Jazz</option>
                <option value="classical">Classical</option>
                <option value="hip-hop">Hip Hop</option>
                <option value="r&b">R&B</option>
                <option value="ambient">Ambient</option>
                <option value="lofi">Lo-Fi</option>
            </select>
        </div>
    </div>

    <button class="btn-generate" id="generateBtn">
        <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
        </svg>
        Generate My Music
    </button>
</div>

<!-- Player Section (Hidden by default) -->
<div class="player-section" id="playerSection" style="display: none;">
    <div class="player-header">
        <h2 class="player-title">üéµ Your Generated Music</h2>
        <div class="player-info">
            <span class="info-badge" id="moodBadge">Mood: Happy</span>
            <span class="info-badge" id="tempoBadge">Tempo: Medium</span>
            <span class="info-badge" id="genreBadge">Genre: Pop</span>
        </div>
    </div>

    <!-- Waveform Animation -->
    <div class="waveform" id="waveform">
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
        <div class="wave-bar"></div>
    </div>

    <!-- Audio Player -->
    <div class="audio-player-wrapper">
        <audio controls class="audio-player" id="audioPlayer">
            <source id="audioSource" type="audio/wav">
            Your browser does not support the audio element.
        </audio>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <button class="btn btn-favorite" id="favoriteBtn" onclick="addToFavorites()">
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" id="heartIcon">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/>
            </svg>
            <span id="favBtnText">Add to Favorites</span>
        </button>
        <button class="btn btn-playlist" id="playlistBtn" onclick="addToPlaylist()">
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
            </svg>
            Add to Playlist
        </button>
        <button class="btn btn-success" id="downloadBtn">
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            Download
        </button>
        <button class="btn btn-secondary" id="saveHistoryBtn">
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
            </svg>
            Save to Library
        </button>
        <button class="btn btn-primary" id="regenerateBtn">
            <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Regenerate
        </button>
    </div>
</div>

<style>
    .btn-favorite { background: #FEF2F2; color: #EF4444; border: 1px solid #FECACA; }
    .btn-favorite:hover { background: #EF4444; color: white; transform: translateY(-2px); }
    .btn-favorite.liked { background: #EF4444; color: white; }
    .btn-favorite.liked svg { fill: white; }
    .btn-playlist { background: #F0FDF4; color: var(--primary-green); border: 1px solid #BBF7D0; }
    .btn-playlist:hover { background: var(--primary-green); color: white; transform: translateY(-2px); }
    .playlist-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .playlist-modal.show { display: flex; }
    .playlist-modal-content { background: white; border-radius: 16px; padding: 24px; width: 90%; max-width: 400px; }
    .playlist-modal h3 { margin-bottom: 16px; color: var(--primary-green); }
    .playlist-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #F5F7F5; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
    .playlist-item:hover { background: #E8F5E9; }
    .playlist-item.selected { background: var(--primary-green); color: white; }
    .create-playlist-input { width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; margin-top: 12px; }
    .modal-buttons { display: flex; gap: 12px; margin-top: 16px; }
    .modal-btn { flex: 1; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; }
    .modal-btn-cancel { background: #F5F7F5; color: #6B7280; }
    .modal-btn-save { background: var(--primary-green); color: white; }
</style>

<!-- Playlist Modal -->
<div class="playlist-modal" id="playlistModal">
    <div class="playlist-modal-content">
        <h3>üìÅ Add to Playlist</h3>
        <div id="playlistList"></div>
        <input type="text" class="create-playlist-input" id="newPlaylistName" placeholder="Create new playlist...">
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-cancel" onclick="closePlaylistModal()">Cancel</button>
            <button class="modal-btn modal-btn-save" onclick="saveToSelectedPlaylist()">Add</button>
        </div>
    </div>
</div>

<script src="/static/js/ai-generator.js"></script>
<script>
// Track music generation
function trackMusicGeneration() {
    const userStats = JSON.parse(localStorage.getItem('userStats') || '{}');
    userStats.tracksGenerated = (userStats.tracksGenerated || 0) + 1;
    userStats.lastGenerated = new Date().toISOString();
    localStorage.setItem('userStats', JSON.stringify(userStats));
}

// Override or add to generate button
document.addEventListener('DOMContentLoaded', function() {
    const generateBtn = document.getElementById('generateBtn');
    if (generateBtn) {
        generateBtn.addEventListener('click', function() {
            // Track the generation
            setTimeout(() => trackMusicGeneration(), 1000);
        });
    }
});

function logout() {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    localStorage.removeItem('token');
    window.location.href = '/';
}

// Favorites functionality
function addToFavorites() {
    const btn = document.getElementById('favoriteBtn');
    const icon = document.getElementById('heartIcon');
    const text = document.getElementById('favBtnText');
    const title = document.getElementById('titleInput').value || 'Untitled Track';
    const mood = document.getElementById('moodInput').value || 'Unknown';
    const genre = document.getElementById('genreInput').value || 'Any';
    
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    const track = { id: Date.now(), title: title, mood: mood, genre: genre, date: new Date().toISOString(), type: 'ai-generated' };
    
    if (!btn.classList.contains('liked')) {
        favorites.push(track);
        localStorage.setItem('favorites', JSON.stringify(favorites));
        btn.classList.add('liked');
        icon.setAttribute('fill', 'currentColor');
        text.textContent = 'Added to Favorites!';
        showNotification('‚ù§Ô∏è Added to Favorites!');
    } else {
        btn.classList.remove('liked');
        icon.setAttribute('fill', 'none');
        text.textContent = 'Add to Favorites';
    }
}

// Playlist functionality
let selectedPlaylistId = null;

function addToPlaylist() {
    loadPlaylists();
    document.getElementById('playlistModal').classList.add('show');
}

function closePlaylistModal() {
    document.getElementById('playlistModal').classList.remove('show');
    selectedPlaylistId = null;
}

function loadPlaylists() {
    let playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
    if (playlists.length === 0) {
        playlists = [{ id: 1, name: 'My Favorites', tracks: [] }, { id: 2, name: 'Chill Vibes', tracks: [] }, { id: 3, name: 'Workout Mix', tracks: [] }];
        localStorage.setItem('playlists', JSON.stringify(playlists));
    }
    const listEl = document.getElementById('playlistList');
    listEl.innerHTML = playlists.map(p => `<div class="playlist-item" data-id="${p.id}" onclick="selectPlaylist(${p.id}, this)">üìÅ ${p.name} (${p.tracks.length} tracks)</div>`).join('');
}

function selectPlaylist(id, el) {
    document.querySelectorAll('.playlist-item').forEach(item => item.classList.remove('selected'));
    el.classList.add('selected');
    selectedPlaylistId = id;
}

function saveToSelectedPlaylist() {
    const newName = document.getElementById('newPlaylistName').value.trim();
    let playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
    const title = document.getElementById('titleInput').value || 'Untitled Track';
    const mood = document.getElementById('moodInput').value || 'Unknown';
    const genre = document.getElementById('genreInput').value || 'Any';
    const track = { id: Date.now(), title: title, mood: mood, genre: genre, date: new Date().toISOString() };
    
    if (newName) {
        const newPlaylist = { id: Date.now(), name: newName, tracks: [track] };
        playlists.push(newPlaylist);
        localStorage.setItem('playlists', JSON.stringify(playlists));
        showNotification(`üìÅ Created "${newName}" and added track!`);
    } else if (selectedPlaylistId) {
        const playlist = playlists.find(p => p.id === selectedPlaylistId);
        if (playlist) {
            playlist.tracks.push(track);
            localStorage.setItem('playlists', JSON.stringify(playlists));
            showNotification(`‚úÖ Added to "${playlist.name}"!`);
        }
    } else {
        showNotification('‚ö†Ô∏è Please select a playlist or create a new one');
        return;
    }
    closePlaylistModal();
    document.getElementById('newPlaylistName').value = '';
}

function showNotification(message) {
    const notif = document.createElement('div');
    notif.style.cssText = 'position: fixed; bottom: 24px; right: 24px; background: var(--primary-green); color: white; padding: 16px 24px; border-radius: 12px; font-weight: 600; z-index: 9999; animation: slideIn 0.3s ease;';
    notif.textContent = message;
    document.body.appendChild(notif);
    setTimeout(() => notif.remove(), 3000);
}
</script>

{% include 'includes/premium_footer.html' %}
</body>
</html>
