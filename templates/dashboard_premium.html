<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - NexGenMusic</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #1B5E20; --primary-light: #2E7D32; --primary-dark: #0D3B12; --accent: #4CAF50; --bg: #F5F7F5; --white: #FFFFFF; --text: #1A1A1A; --text-secondary: #6B7280; --text-muted: #9CA3AF; --border: #E5E7EB; --radius: 12px; --radius-lg: 16px; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        .app { display: flex; min-height: 100vh; }
        .sidebar { width: 260px; background: var(--white); border-right: 1px solid var(--border); position: fixed; height: 100vh; display: flex; flex-direction: column; }
        .sidebar-header { padding: 24px 20px; border-bottom: 1px solid #F0F0F0; }
        .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text); }
        .logo-icon { width: 40px; height: 40px; background: var(--primary); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; }
        .logo-text { font-size: 18px; font-weight: 700; }
        .sidebar-nav { flex: 1; padding: 16px 12px; overflow-y: auto; }
        .nav-section { margin-bottom: 24px; }
        .nav-title { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; padding: 0 12px; margin-bottom: 8px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 14px; border-radius: var(--radius); color: #000000; text-decoration: none; font-size: 14px; font-weight: 700; transition: all 0.2s; margin-bottom: 4px; }
        .nav-item:hover { background: #F0FDF4; color: var(--primary); }
        .nav-item.active { background: var(--primary); color: white; }
        .nav-item svg { width: 20px; height: 20px; stroke: currentColor; }
        .mobile-promo { margin: 12px; padding: 20px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: var(--radius-lg); color: white; }
        .mobile-promo h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .mobile-promo p { font-size: 12px; opacity: 0.9; margin-bottom: 12px; }
        .promo-btn { display: inline-block; background: white; color: var(--primary); padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600; text-decoration: none; }
        .main-wrapper { flex: 1; margin-left: 260px; display: flex; flex-direction: column; min-height: 100vh; }
        .header { background: var(--white); border-bottom: 1px solid var(--border); padding: 16px 32px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 50; }
        .search-box { display: flex; align-items: center; gap: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 10px 16px; width: 320px; }
        .search-box:focus-within { border-color: var(--primary); }
        .search-box input { flex: 1; border: none; background: transparent; font-size: 14px; color: var(--text); outline: none; }
        .header-actions { display: flex; align-items: center; gap: 12px; }
        .icon-btn { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--border); background: var(--white); cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); position: relative; }
        .icon-btn:hover { border-color: var(--primary); color: var(--primary); }
        .notif-dot { position: absolute; top: 8px; right: 8px; width: 8px; height: 8px; background: #EF4444; border-radius: 50%; border: 2px solid white; }
        .user-profile { display: flex; align-items: center; gap: 12px; padding: 6px 12px 6px 6px; border-radius: var(--radius-lg); cursor: pointer; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--accent)); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; }
        .user-info { text-align: left; }
        .user-name { font-size: 14px; font-weight: 600; }
        .user-email { font-size: 12px; color: var(--text-muted); }
        .main-content { flex: 1; padding: 32px; overflow-y: auto; }
        .page-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 32px; }
        .page-title { font-size: 28px; font-weight: 700; }
        .page-subtitle { font-size: 14px; color: var(--text-secondary); margin-top: 4px; }
        .header-btns { display: flex; gap: 12px; }
        .btn-primary { display: inline-flex; align-items: center; gap: 8px; background: var(--primary); color: white; padding: 12px 20px; border-radius: var(--radius); font-size: 14px; font-weight: 600; text-decoration: none; border: none; cursor: pointer; }
        .btn-primary:hover { background: var(--primary-light); }
        .btn-outline { display: inline-flex; align-items: center; gap: 8px; background: white; color: var(--text); padding: 12px 20px; border-radius: var(--radius); font-size: 14px; font-weight: 600; border: 1px solid var(--border); cursor: pointer; text-decoration: none; }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        
        /* Doraemon Vibing */
        .doraemon-section { background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 32px; display: flex; align-items: center; justify-content: center; gap: 32px; overflow: hidden; position: relative; }
        .doraemon-container { position: relative; width: 120px; height: 140px; }
        .doraemon { font-size: 80px; animation: doraemonVibe 0.5s ease-in-out infinite; display: block; text-align: center; }
        @keyframes doraemonVibe { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-10px) rotate(5deg); } }
        .music-notes { position: absolute; font-size: 24px; animation: floatNotes 2s ease-in-out infinite; }
        .note1 { top: 0; right: 0; animation-delay: 0s; }
        .note2 { top: 20px; right: -20px; animation-delay: 0.3s; }
        .note3 { top: -10px; right: 20px; animation-delay: 0.6s; }
        @keyframes floatNotes { 0%, 100% { transform: translateY(0) scale(1); opacity: 1; } 50% { transform: translateY(-15px) scale(1.2); opacity: 0.7; } }
        .headphones { position: absolute; top: 5px; left: 50%; transform: translateX(-50%); font-size: 30px; animation: headphoneBounce 1s ease-in-out infinite; }
        @keyframes headphoneBounce { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-5px); } }
        .vibe-text { text-align: center; }
        .vibe-title { font-size: 20px; font-weight: 700; color: var(--primary-dark); margin-bottom: 8px; }
        .vibe-subtitle { font-size: 14px; color: var(--primary); }
        .sound-waves { display: flex; align-items: flex-end; gap: 4px; height: 40px; }
        .wave-bar { width: 6px; background: var(--primary); border-radius: 3px; animation: waveAnim 0.8s ease-in-out infinite; }
        .wave-bar:nth-child(1) { height: 20px; animation-delay: 0s; }
        .wave-bar:nth-child(2) { height: 35px; animation-delay: 0.1s; }
        .wave-bar:nth-child(3) { height: 25px; animation-delay: 0.2s; }
        .wave-bar:nth-child(4) { height: 40px; animation-delay: 0.3s; }
        .wave-bar:nth-child(5) { height: 30px; animation-delay: 0.4s; }
        .wave-bar:nth-child(6) { height: 20px; animation-delay: 0.5s; }
        @keyframes waveAnim { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(0.5); } }
        .stat-card { background: white; border-radius: var(--radius-lg); padding: 24px; border: 1px solid var(--border); }
        .stat-card:hover { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .stat-card.highlight { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; border: none; }
        .stat-card.highlight .stat-label, .stat-card.highlight .stat-change { color: rgba(255,255,255,0.9); }
        .stat-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .stat-label { font-size: 14px; color: var(--text-secondary); font-weight: 500; }
        .stat-icon { width: 24px; height: 24px; color: var(--text-muted); }
        .stat-card.highlight .stat-icon { color: rgba(255,255,255,0.8); }
        .stat-value { font-size: 36px; font-weight: 700; margin-bottom: 8px; }
        .stat-change { font-size: 13px; color: var(--accent); display: flex; align-items: center; gap: 4px; }
        /* Grid */
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px; }
        .card { background: white; border-radius: var(--radius-lg); border: 1px solid var(--border); overflow: hidden; }
        .card-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid #F0F0F0; }
        .card-title { font-size: 16px; font-weight: 600; }
        .card-body { padding: 24px; }
        /* Chart */
        .chart { display: flex; align-items: flex-end; justify-content: space-between; height: 180px; padding: 20px 0; }
        .chart-bar-group { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .chart-bar { width: 32px; background: linear-gradient(180deg, var(--primary) 0%, var(--primary-light) 100%); border-radius: 8px 8px 0 0; transition: all 0.3s; }
        .chart-bar:hover { transform: scaleY(1.05); }
        .chart-label { font-size: 12px; color: var(--text-muted); font-weight: 500; }
        /* Actions */
        .actions { display: flex; flex-direction: column; gap: 12px; }
        .action-item { display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--bg); border-radius: var(--radius); cursor: pointer; text-decoration: none; color: inherit; transition: all 0.2s; }
        .action-item:hover { background: #F0FDF4; transform: translateX(4px); }
        .action-icon { width: 48px; height: 48px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; }
        .action-info h4 { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
        .action-info p { font-size: 13px; color: var(--text-secondary); }
        /* Recent Tracks */
        .track-list { display: flex; flex-direction: column; gap: 12px; }
        .track-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius); transition: all 0.2s; }
        .track-item:hover { background: var(--bg); }
        .track-cover { width: 48px; height: 48px; border-radius: 8px; background: linear-gradient(135deg, var(--primary), var(--accent)); display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; }
        .track-info { flex: 1; }
        .track-name { font-size: 14px; font-weight: 600; }
        .track-meta { font-size: 12px; color: var(--text-muted); }
        .track-btn { width: 32px; height: 32px; border-radius: 50%; border: none; background: var(--primary); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        /* Now Playing */
        .now-playing { background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%); border-radius: var(--radius-lg); padding: 24px; color: white; text-align: center; }
        .now-playing-label { font-size: 12px; opacity: 0.8; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .now-playing-title { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .now-playing-artist { font-size: 14px; opacity: 0.8; margin-bottom: 16px; }
        .player-controls { display: flex; justify-content: center; gap: 16px; }
        .player-btn { width: 48px; height: 48px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .player-btn.play { background: white; color: var(--primary); }
        .player-btn.secondary { background: rgba(255,255,255,0.2); color: white; }
        /* Mood Card */
        .mood-card { background: white; border-radius: var(--radius-lg); border: 1px solid var(--border); padding: 24px; }
        .mood-title { font-size: 14px; font-weight: 600; margin-bottom: 16px; }
        .mood-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .mood-btn { padding: 12px 8px; background: var(--bg); border: 2px solid transparent; border-radius: var(--radius); cursor: pointer; text-align: center; transition: all 0.2s; }
        .mood-btn:hover { border-color: var(--primary); background: #F0FDF4; }
        .mood-btn.active { border-color: var(--primary); background: var(--primary); color: white; }
        .mood-emoji { font-size: 24px; margin-bottom: 4px; }
        .mood-text { font-size: 11px; font-weight: 500; }
        /* Music Memory Game */
        .game-info { display: flex; gap: 24px; margin-bottom: 16px; padding: 12px 16px; background: var(--bg); border-radius: var(--radius); }
        .game-score, .game-moves, .game-best { font-size: 14px; color: var(--text-secondary); }
        .game-score strong, .game-moves strong, .game-best strong { color: var(--primary); font-size: 16px; }
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .memory-card { aspect-ratio: 1; background: linear-gradient(135deg, var(--primary), var(--primary-light)); border-radius: var(--radius); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 32px; transition: all 0.3s ease; transform-style: preserve-3d; position: relative; }
        .memory-card:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(27, 94, 32, 0.3); }
        .memory-card .card-front, .memory-card .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: var(--radius); }
        .memory-card .card-front { background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; font-size: 24px; }
        .memory-card .card-back { background: white; border: 2px solid var(--primary); transform: rotateY(180deg); font-size: 36px; }
        .memory-card.flipped { transform: rotateY(180deg); }
        .memory-card.matched { background: #F0FDF4; border: 2px solid var(--accent); pointer-events: none; }
        .memory-card.matched .card-front { background: #F0FDF4; }
        .game-message { text-align: center; padding: 16px; margin-top: 16px; border-radius: var(--radius); font-weight: 600; display: none; }
        .game-message.show { display: block; background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; animation: pulse 0.5s ease; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        /* Dancing Cartoon Animations */
        @keyframes dance1 { 0%, 100% { transform: translateY(0) rotate(-10deg); } 50% { transform: translateY(-15px) rotate(10deg); } }
        @keyframes dance2 { 0%, 100% { transform: translateY(0) scaleX(1); } 25% { transform: translateY(-20px) scaleX(1.1); } 50% { transform: translateY(0) scaleX(1); } 75% { transform: translateY(-20px) scaleX(0.9); } }
        @keyframes dance3 { 0%, 100% { transform: translateY(0) rotate(5deg); } 50% { transform: translateY(-12px) rotate(-5deg); } }
        @keyframes floorPulse { 0%, 100% { transform: scaleY(1); opacity: 1; } 50% { transform: scaleY(1.5); opacity: 0.7; } }
        @keyframes floatNote { 0%, 100% { transform: translateY(0) rotate(0deg); opacity: 1; } 50% { transform: translateY(-10px) rotate(15deg); opacity: 0.6; } }
        @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .content-grid { grid-template-columns: 1fr; } }
        @media (max-width: 1024px) { .sidebar { display: none; } .main-wrapper { margin-left: 0; } }
        @media (max-width: 768px) { .stats-grid { grid-template-columns: 1fr; } .page-header { flex-direction: column; align-items: flex-start; gap: 16px; } .header { padding: 12px 16px; } .search-box { display: none; } .main-content { padding: 16px; } }
    </style>
</head>
<body>
<div class="app">
    <aside class="sidebar">
        <div class="sidebar-header"><a href="/dashboard/" class="logo"><div class="logo-icon">‚ô™</div><span class="logo-text">NexGenMusic</span></a></div>
        <nav class="sidebar-nav">
            <div class="nav-section"><div class="nav-title">Menu</div>
                <a href="/dashboard/" class="nav-item active"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6z"/></svg>Dashboard</a>
                <a href="/ai-generator/" class="nav-item"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/></svg>AI Generator</a>
                <a href="/spotify-recommendations/" class="nav-item"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z"/></svg>Spotify</a>
                <a href="/history/" class="nav-item"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>History</a>
            </div>
            <div class="nav-section"><div class="nav-title">Library</div>
                <a href="/library/" class="nav-item"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"/></svg>My Library</a>
                <a href="/library/favorites/" class="nav-item"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg>Favorites</a>
                <a href="/library/playlists/" class="nav-item"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"/></svg>Playlists</a>
            </div>
            <div class="nav-section"><div class="nav-title">General</div>
                <a href="/settings/" class="nav-item"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>Settings</a>
                <a href="#" class="nav-item" onclick="logout(); return false;"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"/></svg>Logout</a>
            </div>
        </nav>
        <div class="mobile-promo" style="background: linear-gradient(135deg, #0D3B12 0%, #1B5E20 100%);"><h4>üì∏ Connect on Instagram</h4><p>Follow for updates & more</p><a href="https://instagram.com/nish.1__" target="_blank" class="promo-btn" style="color: #1B5E20;">Follow @nish.1__</a></div>
    </aside>
  
  <div class="main-wrapper">
        <header class="header">
            <div class="search-box">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:18px;height:18px;color:#9CA3AF"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"/></svg>
                <input type="text" id="dashboardSearch" placeholder="Search music, artists, playlists..." onkeyup="handleSearch(event)">
            </div>
            <div id="searchResults" style="display: none; position: absolute; top: 60px; left: 32px; width: 400px; background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); max-height: 400px; overflow-y: auto; z-index: 100;"></div>
            <div class="header-actions">
                <button class="icon-btn" id="notificationBtn" onclick="toggleNotifications()"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:20px;height:20px"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"/></svg><span class="notif-dot" id="notifDot"></span></button>
                <div class="user-profile" onclick="window.location.href='/profile/'"><div class="user-avatar" id="headerAvatar">U</div><div class="user-info"><div class="user-name" id="headerUsername">User</div><div class="user-email" id="headerEmail">user@email.com</div></div></div>
            </div>
            <div id="notificationPanel" style="display: none; position: absolute; top: 60px; right: 32px; width: 380px; background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); max-height: 500px; overflow-y: auto; z-index: 100;"></div>
        </header>
        <main class="main-content">
            <div class="page-header">
                <div><h1 class="page-title">Dashboard</h1><p class="page-subtitle">Welcome back! Create, discover, and enjoy music with AI.</p></div>
                <div class="header-btns">
                    <a href="/ai-generator/" class="btn-primary"><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>Create Music</a>
                    <a href="/spotify-recommendations/" class="btn-outline">üéß Discover</a>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card highlight" onclick="window.location.href='/ai-generator/'" style="cursor: pointer;">
                    <div class="stat-header"><span class="stat-label">Tracks Generated</span><svg class="stat-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z"/></svg></div>
                    <div class="stat-value" id="tracksGenerated">0</div>
                    <div class="stat-change"><svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18"/></svg>AI-powered creations</div>
                </div>
                <div class="stat-card" onclick="window.location.href='/library/favorites/'" style="cursor: pointer;">
                    <div class="stat-header"><span class="stat-label">Favorite Tracks</span><svg class="stat-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg></div>
                    <div class="stat-value" id="favoritesCount">0</div>
                    <div class="stat-change">Saved to library</div>
                </div>
                <div class="stat-card" onclick="window.location.href='/library/playlists/'" style="cursor: pointer;">
                    <div class="stat-header"><span class="stat-label">Playlists</span><svg class="stat-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"/></svg></div>
                    <div class="stat-value" id="playlistsCount">0</div>
                    <div class="stat-change">Custom collections</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header"><span class="stat-label">Total Activity</span><svg class="stat-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div>
                    <div class="stat-value" id="totalActivity">0</div>
                    <div class="stat-change">All time</div>
                </div>
            </div>

            <!-- Doraemon Vibing Section -->
            <div class="doraemon-section">
                <div class="sound-waves">
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                </div>
                <div class="doraemon-container">
                    <span class="headphones">üéß</span>
                    <span class="doraemon">üê±</span>
                    <span class="music-notes note1">üéµ</span>
                    <span class="music-notes note2">üé∂</span>
                    <span class="music-notes note3">‚ô™</span>
                </div>
                <div class="vibe-text">
                    <div class="vibe-title">üéµ Vibing to Music!</div>
                    <div class="vibe-subtitle">Let the rhythm take over</div>
                </div>
                <div class="sound-waves">
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                    <div class="wave-bar"></div>
                </div>
            </div>

            <!-- Content Grid Row 1 - Music Memory Game -->
            <div class="content-grid">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">üéÆ Music Memory Game</h3><button class="btn-outline" style="padding: 8px 16px; font-size: 13px;" onclick="resetGame()">New Game</button></div>
                    <div class="card-body">
                        <div class="game-info">
                            <span class="game-score">Score: <strong id="gameScore">0</strong></span>
                            <span class="game-moves">Moves: <strong id="gameMoves">0</strong></span>
                            <span class="game-best">Best: <strong id="gameBest">0</strong></span>
                        </div>
                        <div class="memory-grid" id="memoryGrid">
                            <!-- Cards will be generated by JavaScript -->
                        </div>
                        <div class="game-message" id="gameMessage"></div>
                    </div>
                </div>
                <div class="mood-card">
                    <div class="mood-title">üé≠ How are you feeling?</div>
                    <div class="mood-grid">
                        <div class="mood-btn" onclick="selectMood(this, 'happy')"><div class="mood-emoji">üòä</div><div class="mood-text">Happy</div></div>
                        <div class="mood-btn" onclick="selectMood(this, 'chill')"><div class="mood-emoji">üòå</div><div class="mood-text">Chill</div></div>
                        <div class="mood-btn" onclick="selectMood(this, 'energetic')"><div class="mood-emoji">‚ö°</div><div class="mood-text">Energetic</div></div>
                        <div class="mood-btn" onclick="selectMood(this, 'sad')"><div class="mood-emoji">üò¢</div><div class="mood-text">Sad</div></div>
                        <div class="mood-btn" onclick="selectMood(this, 'romantic')"><div class="mood-emoji">‚ù§Ô∏è</div><div class="mood-text">Romantic</div></div>
                        <div class="mood-btn" onclick="selectMood(this, 'focus')"><div class="mood-emoji">üéØ</div><div class="mood-text">Focus</div></div>
                    </div>
                    <a href="/spotify-recommendations/" class="btn-primary" style="width: 100%; justify-content: center; margin-top: 16px;">Get Recommendations</a>
                    
                    <!-- Mini Stats Grid -->
                    <div class="mini-stats-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <div class="mini-stat" style="background: var(--bg); padding: 16px; border-radius: var(--radius); text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 4px;">üéµ</div>
                            <div style="font-size: 20px; font-weight: 700; color: var(--primary);" id="miniTracksGenerated">0</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Tracks Generated</div>
                        </div>
                        <div class="mini-stat" style="background: var(--bg); padding: 16px; border-radius: var(--radius); text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 4px;">‚ù§Ô∏è</div>
                            <div style="font-size: 20px; font-weight: 700; color: var(--primary);" id="miniFavorites">0</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Favorites</div>
                        </div>
                        <div class="mini-stat" style="background: var(--bg); padding: 16px; border-radius: var(--radius); text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 4px;">üìÅ</div>
                            <div style="font-size: 20px; font-weight: 700; color: var(--primary);" id="miniPlaylists">0</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Playlists</div>
                        </div>
                        <div class="mini-stat" style="background: var(--bg); padding: 16px; border-radius: var(--radius); text-align: center;">
                            <div style="font-size: 24px; margin-bottom: 4px;">üî•</div>
                            <div style="font-size: 20px; font-weight: 700; color: var(--primary);" id="miniStreak">0</div>
                            <div style="font-size: 11px; color: var(--text-muted);">Day Streak</div>
                        </div>
                    </div>
                    
                    <!-- Trending Now Section -->
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">üî• Trending Now</div>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg); border-radius: var(--radius); cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#F0FDF4'" onmouseout="this.style.background='var(--bg)'">
                                <span style="font-size: 18px;">üéµ</span>
                                <div style="flex: 1;">
                                    <div style="font-size: 13px; font-weight: 600;">Chill Beats</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">2.5M plays</div>
                                </div>
                                <span style="font-size: 12px; color: var(--accent);">‚ñ≤ 12%</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg); border-radius: var(--radius); cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#F0FDF4'" onmouseout="this.style.background='var(--bg)'">
                                <span style="font-size: 18px;">üé∂</span>
                                <div style="flex: 1;">
                                    <div style="font-size: 13px; font-weight: 600;">Lo-Fi Study</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">1.8M plays</div>
                                </div>
                                <span style="font-size: 12px; color: var(--accent);">‚ñ≤ 8%</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg); border-radius: var(--radius); cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#F0FDF4'" onmouseout="this.style.background='var(--bg)'">
                                <span style="font-size: 18px;">üéß</span>
                                <div style="flex: 1;">
                                    <div style="font-size: 13px; font-weight: 600;">Workout Mix</div>
                                    <div style="font-size: 11px; color: var(--text-muted);">1.2M plays</div>
                                </div>
                                <span style="font-size: 12px; color: var(--accent);">‚ñ≤ 15%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dancing Cartoon Section -->
                    <div class="dancing-cartoon-section" style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: var(--radius-lg); text-align: center; position: relative; overflow: hidden;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--primary-dark); margin-bottom: 12px;">üéâ Vibing Zone</div>
                        <div class="dancers-container" style="display: flex; justify-content: center; align-items: flex-end; gap: 16px; height: 80px;">
                            <div class="dancer dancer1" style="font-size: 36px; animation: dance1 0.6s ease-in-out infinite;">üï∫</div>
                            <div class="dancer dancer2" style="font-size: 42px; animation: dance2 0.5s ease-in-out infinite;">üíÉ</div>
                            <div class="dancer dancer3" style="font-size: 36px; animation: dance3 0.7s ease-in-out infinite;">üê±</div>
                        </div>
                        <div class="music-floor" style="display: flex; justify-content: center; gap: 3px; margin-top: 8px;">
                            <span class="floor-bar" style="width: 4px; height: 8px; background: var(--primary); border-radius: 2px; animation: floorPulse 0.4s ease-in-out infinite;"></span>
                            <span class="floor-bar" style="width: 4px; height: 12px; background: var(--accent); border-radius: 2px; animation: floorPulse 0.4s ease-in-out infinite 0.1s;"></span>
                            <span class="floor-bar" style="width: 4px; height: 6px; background: var(--primary); border-radius: 2px; animation: floorPulse 0.4s ease-in-out infinite 0.2s;"></span>
                            <span class="floor-bar" style="width: 4px; height: 14px; background: var(--accent); border-radius: 2px; animation: floorPulse 0.4s ease-in-out infinite 0.3s;"></span>
                            <span class="floor-bar" style="width: 4px; height: 10px; background: var(--primary); border-radius: 2px; animation: floorPulse 0.4s ease-in-out infinite 0.4s;"></span>
                            <span class="floor-bar" style="width: 4px; height: 8px; background: var(--accent); border-radius: 2px; animation: floorPulse 0.4s ease-in-out infinite 0.5s;"></span>
                        </div>
                        <!-- Floating music notes -->
                        <span style="position: absolute; top: 10px; left: 15px; font-size: 16px; animation: floatNote 2s ease-in-out infinite;">üéµ</span>
                        <span style="position: absolute; top: 20px; right: 20px; font-size: 14px; animation: floatNote 2s ease-in-out infinite 0.5s;">üé∂</span>
                        <span style="position: absolute; bottom: 30px; left: 25px; font-size: 12px; animation: floatNote 2s ease-in-out infinite 1s;">‚ô™</span>
                        <span style="position: absolute; bottom: 25px; right: 15px; font-size: 14px; animation: floatNote 2s ease-in-out infinite 1.5s;">‚ô´</span>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="content-grid">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">‚ö° Quick Actions</h3></div>
                    <div class="card-body">
                        <div class="actions">
                            <a href="/ai-generator/" class="action-item"><div class="action-icon" style="background: linear-gradient(135deg, #1B5E20, #4CAF50);">‚ú®</div><div class="action-info"><h4>AI Music Generator</h4><p>Create unique tracks with AI</p></div></a>
                            <a href="/spotify-recommendations/" class="action-item"><div class="action-icon" style="background: linear-gradient(135deg, #1DB954, #191414);">üéß</div><div class="action-info"><h4>Spotify Recommendations</h4><p>Discover music based on mood</p></div></a>
                            <a href="/library/" class="action-item"><div class="action-icon" style="background: linear-gradient(135deg, #9333EA, #EC4899);">üìö</div><div class="action-info"><h4>My Library</h4><p>Browse your music collection</p></div></a>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">üéº Top Genres</h3></div>
                    <div class="card-body">
                        <div class="track-list">
                            <div class="track-item"><div class="track-cover" style="background: linear-gradient(135deg, #FF6B6B, #FF8E53);">üé§</div><div class="track-info"><div class="track-name">Pop</div><div class="track-meta">8 tracks generated</div></div></div>
                            <div class="track-item"><div class="track-cover" style="background: linear-gradient(135deg, #4ECDC4, #44A08D);">üé∑</div><div class="track-info"><div class="track-name">Jazz</div><div class="track-meta">5 tracks generated</div></div></div>
                            <div class="track-item"><div class="track-cover" style="background: linear-gradient(135deg, #667eea, #764ba2);">üéπ</div><div class="track-info"><div class="track-name">Classical</div><div class="track-meta">4 tracks generated</div></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
<script>
// Mood Selection
function selectMood(el, mood) {
    document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
    el.classList.add('active');
    localStorage.setItem('selectedMood', mood);
}
function logout() { 
    if (confirm('Are you sure you want to logout?')) {
        // Only remove session tokens, keep user data
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        localStorage.removeItem('token');
        window.location.href = '/'; 
    }
}

// Music Memory Game
const musicEmojis = ['üéµ', 'üé∂', 'üé∏', 'üéπ', 'üé∑', 'üé∫', 'ü•Å', 'üéª'];
let cards = [];
let flippedCards = [];
let matchedPairs = 0;
let moves = 0;
let score = 0;
let canFlip = true;

function initGame() {
    const gameEmojis = [...musicEmojis, ...musicEmojis];
    cards = gameEmojis.sort(() => Math.random() - 0.5);
    flippedCards = [];
    matchedPairs = 0;
    moves = 0;
    score = 0;
    canFlip = true;
    updateStats();
    renderCards();
    document.getElementById('gameMessage').classList.remove('show');
}

function renderCards() {
    const grid = document.getElementById('memoryGrid');
    grid.innerHTML = cards.map((emoji, index) => `
        <div class="memory-card" onclick="flipCard(this, ${index})">
            <div class="card-front">‚ô™</div>
            <div class="card-back">${emoji}</div>
        </div>
    `).join('');
}

function flipCard(card, index) {
    if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) return;
    
    card.classList.add('flipped');
    flippedCards.push({ card, index, emoji: cards[index] });
    
    if (flippedCards.length === 2) {
        moves++;
        canFlip = false;
        checkMatch();
    }
}

function checkMatch() {
    const [first, second] = flippedCards;
    
    if (first.emoji === second.emoji) {
        first.card.classList.add('matched');
        second.card.classList.add('matched');
        matchedPairs++;
        score += 10;
        
        if (matchedPairs === musicEmojis.length) {
            const bonus = Math.max(0, 100 - moves * 2);
            score += bonus;
            showMessage(`üéâ You Won! +${bonus} bonus points!`);
            updateBestScore();
        }
        
        flippedCards = [];
        canFlip = true;
    } else {
        setTimeout(() => {
            first.card.classList.remove('flipped');
            second.card.classList.remove('flipped');
            flippedCards = [];
            canFlip = true;
        }, 800);
    }
    updateStats();
}

function updateStats() {
    document.getElementById('gameScore').textContent = score;
    document.getElementById('gameMoves').textContent = moves;
    const best = localStorage.getItem('memoryBestScore') || 0;
    document.getElementById('gameBest').textContent = best;
}

function updateBestScore() {
    const best = localStorage.getItem('memoryBestScore') || 0;
    if (score > best) {
        localStorage.setItem('memoryBestScore', score);
        document.getElementById('gameBest').textContent = score;
    }
}

function showMessage(msg) {
    const el = document.getElementById('gameMessage');
    el.textContent = msg;
    el.classList.add('show');
}

function resetGame() { initGame(); }

// Initialize game on page load
document.addEventListener('DOMContentLoaded', initGame);

// Search functionality
const searchData = {
    pages: [
        { title: 'AI Generator', url: '/ai-generator/', icon: '‚ú®', description: 'Create custom music with AI' },
        { title: 'Spotify Recommendations', url: '/spotify-recommendations/', icon: 'üéß', description: 'Discover music based on mood' },
        { title: 'History', url: '/history/', icon: 'üïê', description: 'View your music history' },
        { title: 'Favorites', url: '/library/favorites/', icon: '‚ù§Ô∏è', description: 'Your liked tracks' },
        { title: 'Playlists', url: '/library/playlists/', icon: 'üìÅ', description: 'Your playlists' },
        { title: 'My Library', url: '/library/', icon: 'üìö', description: 'Browse your collection' },
        { title: 'Settings', url: '/settings/', icon: '‚öôÔ∏è', description: 'Account settings' },
        { title: 'Profile', url: '/profile/', icon: 'üë§', description: 'Manage your profile' },
        { title: 'About', url: '/about/', icon: '‚ÑπÔ∏è', description: 'About NexGenMusic' }
    ],
    tracks: [
        { title: 'Summer Vibes', type: 'AI Generated', mood: 'Happy', icon: 'üéµ' },
        { title: 'Midnight Jazz', type: 'AI Generated', mood: 'Chill', icon: 'üé∂' },
        { title: 'Piano Dreams', type: 'AI Generated', mood: 'Calm', icon: 'üéπ' },
        { title: 'Rock Anthem', type: 'AI Generated', mood: 'Energetic', icon: 'üé∏' }
    ],
    moods: ['Happy', 'Sad', 'Energetic', 'Chill', 'Romantic', 'Angry', 'Focus', 'Peaceful']
};

function handleSearch(event) {
    const query = event.target.value.toLowerCase().trim();
    const resultsDiv = document.getElementById('searchResults');
    
    if (query.length < 2) {
        resultsDiv.style.display = 'none';
        return;
    }
    
    // Search pages
    const pageResults = searchData.pages.filter(page => 
        page.title.toLowerCase().includes(query) || 
        page.description.toLowerCase().includes(query)
    );
    
    // Search tracks
    const trackResults = searchData.tracks.filter(track => 
        track.title.toLowerCase().includes(query) || 
        track.mood.toLowerCase().includes(query)
    );
    
    // Search moods
    const moodResults = searchData.moods.filter(mood => 
        mood.toLowerCase().includes(query)
    );
    
    // Build results HTML
    let html = '<div style="padding: 16px;">';
    
    if (pageResults.length > 0) {
        html += '<div style="margin-bottom: 16px;"><div style="font-size: 11px; font-weight: 600; color: #9CA3AF; text-transform: uppercase; margin-bottom: 8px;">Pages</div>';
        pageResults.forEach(page => {
            html += `
                <a href="${page.url}" style="display: flex; align-items: center; gap: 12px; padding: 10px; border-radius: 8px; text-decoration: none; color: inherit; transition: all 0.2s;" onmouseover="this.style.background='#F0FDF4'" onmouseout="this.style.background='transparent'">
                    <span style="font-size: 20px;">${page.icon}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 14px;">${page.title}</div>
                        <div style="font-size: 12px; color: #6B7280;">${page.description}</div>
                    </div>
                </a>`;
        });
        html += '</div>';
    }
    
    if (trackResults.length > 0) {
        html += '<div style="margin-bottom: 16px;"><div style="font-size: 11px; font-weight: 600; color: #9CA3AF; text-transform: uppercase; margin-bottom: 8px;">Tracks</div>';
        trackResults.forEach(track => {
            html += `
                <div style="display: flex; align-items: center; gap: 12px; padding: 10px; border-radius: 8px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#F0FDF4'" onmouseout="this.style.background='transparent'">
                    <span style="font-size: 20px;">${track.icon}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 14px;">${track.title}</div>
                        <div style="font-size: 12px; color: #6B7280;">${track.type} ‚Ä¢ ${track.mood}</div>
                    </div>
                </div>`;
        });
        html += '</div>';
    }
    
    if (moodResults.length > 0) {
        html += '<div><div style="font-size: 11px; font-weight: 600; color: #9CA3AF; text-transform: uppercase; margin-bottom: 8px;">Moods</div>';
        moodResults.forEach(mood => {
            html += `
                <a href="/spotify-recommendations/?mood=${mood.toLowerCase()}" style="display: inline-block; padding: 8px 16px; background: #F0FDF4; border-radius: 20px; margin: 4px; text-decoration: none; color: #1B5E20; font-size: 13px; font-weight: 500; transition: all 0.2s;" onmouseover="this.style.background='#1B5E20'; this.style.color='white'" onmouseout="this.style.background='#F0FDF4'; this.style.color='#1B5E20'">
                    ${mood}
                </a>`;
        });
        html += '</div>';
    }
    
    if (pageResults.length === 0 && trackResults.length === 0 && moodResults.length === 0) {
        html += '<div style="text-align: center; padding: 24px; color: #6B7280;"><div style="font-size: 32px; margin-bottom: 8px;">üîç</div><div>No results found for "${query}"</div></div>';
    }
    
    html += '</div>';
    resultsDiv.innerHTML = html;
    resultsDiv.style.display = 'block';
}

// Close search results when clicking outside
document.addEventListener('click', function(event) {
    const searchBox = document.querySelector('.search-box');
    const resultsDiv = document.getElementById('searchResults');
    if (searchBox && resultsDiv && !searchBox.contains(event.target) && !resultsDiv.contains(event.target)) {
        resultsDiv.style.display = 'none';
    }
});

// Clear search on Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        document.getElementById('searchResults').style.display = 'none';
        document.getElementById('dashboardSearch').value = '';
        document.getElementById('notificationPanel').style.display = 'none';
    }
});

// Notification System
let notifications = [
    { id: 1, type: 'success', icon: '‚úÖ', title: 'Track Generated', message: 'Your AI music "Summer Vibes" is ready!', time: '2 min ago', read: false },
    { id: 2, type: 'info', icon: 'üéµ', title: 'New Recommendation', message: 'Check out new tracks based on your mood', time: '1 hour ago', read: false },
    { id: 3, type: 'like', icon: '‚ù§Ô∏è', title: 'Track Liked', message: 'You added "Midnight Jazz" to favorites', time: '3 hours ago', read: true },
    { id: 4, type: 'playlist', icon: 'üìÅ', title: 'Playlist Updated', message: 'New track added to "Chill Vibes"', time: '5 hours ago', read: true },
    { id: 5, type: 'info', icon: 'üéß', title: 'Spotify Connected', message: 'Your Spotify account is now linked', time: '1 day ago', read: true }
];

function toggleNotifications() {
    const panel = document.getElementById('notificationPanel');
    if (panel.style.display === 'none') {
        renderNotifications();
        panel.style.display = 'block';
        // Mark all as read
        setTimeout(() => {
            notifications.forEach(n => n.read = true);
            updateNotificationDot();
        }, 1000);
    } else {
        panel.style.display = 'none';
    }
}

function renderNotifications() {
    const panel = document.getElementById('notificationPanel');
    const unreadCount = notifications.filter(n => !n.read).length;
    
    let html = `
        <div style="padding: 16px; border-bottom: 1px solid #E5E7EB; display: flex; align-items: center; justify-content: space-between;">
            <div>
                <h3 style="font-size: 16px; font-weight: 600;">Notifications</h3>
                ${unreadCount > 0 ? `<span style="font-size: 12px; color: #6B7280;">${unreadCount} unread</span>` : ''}
            </div>
            <button onclick="clearAllNotifications()" style="font-size: 12px; color: var(--primary); background: none; border: none; cursor: pointer; font-weight: 600;">Clear All</button>
        </div>
        <div style="padding: 8px;">
    `;
    
    if (notifications.length === 0) {
        html += `
            <div style="text-align: center; padding: 48px 24px; color: #6B7280;">
                <div style="font-size: 48px; margin-bottom: 12px;">üîî</div>
                <div style="font-weight: 600; margin-bottom: 4px;">No notifications</div>
                <div style="font-size: 13px;">You're all caught up!</div>
            </div>
        `;
    } else {
        notifications.forEach(notif => {
            const bgColor = notif.read ? 'transparent' : '#F0FDF4';
            html += `
                <div style="display: flex; gap: 12px; padding: 12px; border-radius: 8px; background: ${bgColor}; margin-bottom: 4px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#F0FDF4'" onmouseout="this.style.background='${bgColor}'" onclick="handleNotificationClick(${notif.id})">
                    <div style="font-size: 24px; flex-shrink: 0;">${notif.icon}</div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">${notif.title}</div>
                        <div style="font-size: 13px; color: #6B7280; margin-bottom: 4px;">${notif.message}</div>
                        <div style="font-size: 11px; color: #9CA3AF;">${notif.time}</div>
                    </div>
                    <button onclick="event.stopPropagation(); removeNotification(${notif.id})" style="width: 24px; height: 24px; border-radius: 50%; background: #F5F7F5; border: none; cursor: pointer; color: #6B7280; font-size: 16px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;" onmouseover="this.style.background='#EF4444'; this.style.color='white'" onmouseout="this.style.background='#F5F7F5'; this.style.color='#6B7280'">√ó</button>
                </div>
            `;
        });
    }
    
    html += '</div>';
    panel.innerHTML = html;
}

function handleNotificationClick(id) {
    const notif = notifications.find(n => n.id === id);
    if (!notif) return;
    
    // Navigate based on notification type
    if (notif.type === 'success') {
        window.location.href = '/ai-generator/';
    } else if (notif.type === 'info') {
        window.location.href = '/spotify-recommendations/';
    } else if (notif.type === 'like') {
        window.location.href = '/library/favorites/';
    } else if (notif.type === 'playlist') {
        window.location.href = '/library/playlists/';
    }
}

function removeNotification(id) {
    notifications = notifications.filter(n => n.id !== id);
    renderNotifications();
    updateNotificationDot();
}

function clearAllNotifications() {
    notifications = [];
    renderNotifications();
    updateNotificationDot();
    document.getElementById('notificationPanel').style.display = 'none';
}

function updateNotificationDot() {
    const dot = document.getElementById('notifDot');
    const unreadCount = notifications.filter(n => !n.read).length;
    dot.style.display = unreadCount > 0 ? 'block' : 'none';
}

function addNotification(type, icon, title, message) {
    const newNotif = {
        id: Date.now(),
        type: type,
        icon: icon,
        title: title,
        message: message,
        time: 'Just now',
        read: false
    };
    notifications.unshift(newNotif);
    updateNotificationDot();
}

// Close notification panel when clicking outside
document.addEventListener('click', function(event) {
    const notifBtn = document.getElementById('notificationBtn');
    const notifPanel = document.getElementById('notificationPanel');
    if (notifBtn && notifPanel && !notifBtn.contains(event.target) && !notifPanel.contains(event.target)) {
        notifPanel.style.display = 'none';
    }
});

// Initialize notification dot
updateNotificationDot();

// Load User Profile Data
function loadUserProfile() {
    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
    const userAvatar = localStorage.getItem('userAvatar');
    
    // Update header
    if (userData.username) {
        document.getElementById('headerUsername').textContent = userData.username;
        const avatarEl = document.getElementById('headerAvatar');
        if (userAvatar) {
            avatarEl.style.backgroundImage = `url(${userAvatar})`;
            avatarEl.style.backgroundSize = 'cover';
            avatarEl.style.backgroundPosition = 'center';
            avatarEl.textContent = '';
        } else {
            avatarEl.textContent = userData.username.charAt(0).toUpperCase();
        }
    }
    
    if (userData.email) {
        document.getElementById('headerEmail').textContent = userData.email;
    }
}

// Load and update stats
function loadStats() {
    // Get data from localStorage
    const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    const playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
    const userStats = JSON.parse(localStorage.getItem('userStats') || '{}');
    
    // Calculate stats
    const tracksGenerated = userStats.tracksGenerated || 0;
    const favoritesCount = favorites.length;
    const playlistsCount = playlists.length;
    const totalActivity = tracksGenerated + favoritesCount + playlistsCount;
    
    // Calculate streak (days with activity)
    const lastActivity = userStats.lastActivity || new Date().toISOString();
    const daysSinceActivity = Math.floor((new Date() - new Date(lastActivity)) / (1000 * 60 * 60 * 24));
    const streak = daysSinceActivity === 0 ? (userStats.streak || 1) : 1;
    
    // Update main stats
    document.getElementById('tracksGenerated').textContent = tracksGenerated;
    document.getElementById('favoritesCount').textContent = favoritesCount;
    document.getElementById('playlistsCount').textContent = playlistsCount;
    document.getElementById('totalActivity').textContent = totalActivity;
    
    // Update mini stats
    document.getElementById('miniTracksGenerated').textContent = tracksGenerated;
    document.getElementById('miniFavorites').textContent = favoritesCount;
    document.getElementById('miniPlaylists').textContent = playlistsCount;
    document.getElementById('miniStreak').textContent = streak;
}

// Function to increment track generation count
function incrementTrackGeneration() {
    const userStats = JSON.parse(localStorage.getItem('userStats') || '{}');
    userStats.tracksGenerated = (userStats.tracksGenerated || 0) + 1;
    localStorage.setItem('userStats', JSON.stringify(userStats));
    loadStats();
}

// Initialize user profile and stats on page load
document.addEventListener('DOMContentLoaded', function() {
    loadUserProfile();
    loadStats();
});

// Example: Add notification when user generates music (you can call this from other functions)
// addNotification('success', '‚úÖ', 'Track Generated', 'Your new track is ready!');
</script>
</body>
</html>